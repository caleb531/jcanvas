/*
 jCanvas
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(d,W,ba,P,ca,t,F,f,s){function D(){}function G(c){c?y(da,c):G.prefs=da=D.prototype=y({},R);return this}function J(c,a){c.fillStyle=a.fillStyle;c.strokeStyle=a.strokeStyle;c.lineWidth=a.strokeWidth;a.rounded?(c.lineCap="round",c.lineJoin="round"):(c.lineCap=a.strokeCap,c.lineJoin=a.strokeJoin,c.miterLimit=a.miterLimit);c.shadowOffsetX=a.shadowX;c.shadowOffsetY=a.shadowY;c.shadowBlur=a.shadowBlur;c.shadowColor=a.shadowColor;c.globalAlpha=a.opacity;c.globalCompositeOperation=a.compositing}function A(c){return c&&
c.getContext?c.getContext("2d"):f}function M(c,a,b){b.closed&&a.closePath();a.fill();"transparent"!==b.fillStyle&&(a.shadowColor="transparent");0!==b.strokeWidth&&a.stroke();b.closed||a.closePath();a.restore();b.mask&&(b.autosave&&(a.save(),c=K(c),c.transforms.mask=t,c.savedTransforms=y({},c.transforms)),a.clip())}function ea(c,a,b){a._toRad=a.inDegrees?z/180:1;c.translate(a.x,a.y);c.rotate(a.rotate*a._toRad);c.translate(-a.x,-a.y);b.rotate+=a.rotate*a._toRad}function fa(c,a,b){1!==a.scale&&(a.scaleX=
a.scaleY=a.scale);c.translate(a.x,a.y);c.scale(a.scaleX,a.scaleY);c.translate(-a.x,-a.y);b.scaleX*=a.scaleX;b.scaleY*=a.scaleY}function ga(c,a,b){a.translate&&(a.translateX=a.translateY=a.translate);c.translate(a.translateX,a.translateY);b.translateX+=a.translateX;b.translateY+=a.translateY}function I(c,a,b,e){a._toRad=a.inDegrees?z/180:1;c.save();e===s&&(e=b);!a.fromCenter&&!a._centered&&(a.x+=b/2,a.y+=e/2,a._centered=t);a.rotate&&ea(c,a,{});(1!==a.scale||1!==a.scaleX||1!==a.scaleY)&&fa(c,a,{});
(a.translate||a.translateX||a.translateY)&&ga(c,a,{})}function X(c){c.draggable&&(c.translateX+=c.x,c.translateY+=c.y)}function K(c){var a;E.canvas===c?a=E.data:(a=d.data(c,"jCanvas"),a||(a={layers:[],intersects:[],drag:{},event:{},transforms:{rotate:0,scaleX:1,scaleY:1,translateX:0,translateY:0,mask:F}},a.savedTransforms=y({},a.transforms),d.data(c,"jCanvas",a)),E.canvas=c,E.data=a);return a}function ha(c,a,b){b&&b.visible&&(b.method===d.fn.draw?b.fn.call(c[0],a):b.method&&b.method.call(c,b))}function H(c,
a,b,e){var i,g,B="function"===typeof b,C,b=b||{};a._args=b;if(b.layer&&!b._layer){i=d(c);a=i.getLayers();B&&(b={method:d.fn.draw,fn:b});b=y(new D,b);if(!B){b.method=d.fn[b.method]||e;C=K(c);for(g in G.events)G.events.hasOwnProperty(g)&&b[g]&&(g=Y(g),G.events[g](i,C),b._event=t);if(b.draggable||b.cursor){b._event=t;c=["mousedown","mousemove","mouseup"];for(e=0;e<c.length;e+=1)g=Y(c[e]),G.events[g](i,C);C.mouseout||(i.bind("mouseout.jCanvas",function(){C.drag={};i.drawLayers()}),C.mouseout=t)}}b.layer=
t;b._layer=t;b.index===s&&(b.index=a.length);a.splice(b.index,0,b)}return b}function ia(c){var a;for(a=0;a<O.length;a+=1)c[O[a]]=c["_"+O[a]]}function ja(c,a){var b;for(b=0;b<O.length;b+=1)c["_"+O[b]]=c[O[b]],Z[O[b]]=1,a&&delete c[O[b]]}function ka(c){var a,b,e=[],i=1;c.match(/^#?\w+$/i)&&("transparent"===c&&(c="rgba(0,0,0,0)"),b=W.head,a=b.style.color,b.style.color=c,c=d.css(b,"color"),b.style.color=a);c.match(/^rgb/i)&&(e=c.match(/\d+/gi),c.match(/%/gi)&&(i=2.55),e[0]*=i,e[1]*=i,e[2]*=i,e[3]=e[3]!==
s?ca(e[3]):1);return e}function oa(c){var a=3,b;"object"!==typeof c.start&&(c.start=ka(c.start),c.end=ka(c.end));c.now=[];if(1!==c.start[3]||1!==c.end[3])a=4;for(b=0;b<a;b+=1)c.now[b]=c.start[b]+(c.end[b]-c.start[b])*c.pos,3>b&&(c.now[b]=S(c.now[b]));1!==c.start[3]||1!==c.end[3]?c.now="rgba("+c.now.join(",")+")":(c.now.slice(0,3),c.now="rgb("+c.now.join(",")+")");c.elem.nodeName?c.elem.style[c.prop]=c.now:c.elem[c.prop]=c.now}function Y(c){"ontouchstart"in window&&$[c]&&(c=$[c]);return c}function N(c){G.events[c]=
function(a,b){c=Y(c);var e="mouseover"===c||"mouseout"===c?"mousemove":c,i=b.event;b[e]||(a.bind(e+".jCanvas",function(b){i.x=b.offsetX;i.y=b.offsetY;i.type=e;i.event=b;a.drawLayers(t);b.preventDefault()}),b[e]=t)}}function L(c,a,b){var e,i,g,d,b=b._args;b._event&&(c=K(c),e=c.event,a=a.isPointInPath(e.x,e.y),i=c.transforms,b.eventX=b.mouseX=e.x,b.eventY=b.mouseY=e.y,b.event=e.event,d=c.transforms.rotate,e=b.eventX,g=b.eventY,b._eventX=e*Q(-d)-g*T(-d),b._eventY=g*Q(-d)+e*T(-d),b._eventX/=i.scaleX,
b._eventY/=i.scaleY,!a&&(b._hovered&&!b._fired)&&(b._mousedout=t),a&&c.intersects.push(b))}function U(c,a,b,e,i){a.save();a.beginPath();a.rect(e[0],i[0],e[1]-e[0],i[1]-i[0]);a.clip();I(a,b,0);a.beginPath()}function V(c,a,b){b._event&&L(c,a,b);a.restore();M(c,a,b)}function la(c,a){a.font?c.font=a.font:(isNaN(Number(a.fontSize))||(a.fontSize+="px"),c.font=a.fontStyle+" "+a.fontSize+" "+a.fontFamily)}function ma(c,a,b,e,i){var g=/\b(\d*\.?\d*)\w\w\b/gi,B;if(E.text===e.text&&E.font===e.font&&E.fontStyle===
e.fontStyle&&E.fontSize===e.fontSize&&E.fontFamily===e.fontFamily&&E.maxWidth===e.maxWidth&&E.lineHeight===e.lineHeight)e.width=E.width,e.height=E.height;else if(!a){e.width=b.measureText(i[0]).width;for(a=1;a<i.length;a+=1)B=b.measureText(i[a]).width,B>e.width&&(e.width=B);b=c.style.fontSize;if(e.font){if(a=e.font.match(g))c.style.fontSize=e.font.match(g)[0]}else c.style.fontSize=e.fontSize;e.height=ca(d.css(c,"fontSize"))*i.length*e.lineHeight;c.style.fontSize=b}}var R,da,y=d.extend,S=P.round,z=
P.PI,T=P.sin,Q=P.cos,pa=d.event.fix,$,aa,na,E={},O,Z;d.fn.jCanvas=G;G.events={};R={align:"center",autosave:t,baseline:"middle",bringToFront:F,ccw:F,closed:F,compositing:"source-over",cornerRadius:0,cropFromCenter:t,disableDrag:F,disableEvents:F,domain:f,draggable:F,each:f,end:360,fillStyle:"transparent",font:"",fontStyle:"",fontSize:"12pt",fontFamily:"sans-serif",fromCenter:t,fn:f,graph:"y",height:f,inDegrees:t,lineHeight:1,load:f,mask:F,maxWidth:f,method:f,miterLimit:10,opacity:1,projection:0,r1:f,
r2:f,radius:0,range:f,repeat:"repeat",rotate:0,rounded:F,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:f,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:f,sx:f,sy:f,text:"",translate:0,translateX:0,translateY:0,type:f,visible:t,width:f,x:0,y:0};G();G.extend=function(c){G.defaults=R=y(R,c.props);G();c.name&&(d.fn[c.name]=function b(e){var i,g,d,C=y(new D,e);for(g=0;g<this.length;g+=1)if(i=this[g],
d=A(i))e=H(i,C,e,b),J(d,C),c.fn.call(i,d,C);return this});return d.fn[c.name]};d.fn.getLayers=function(){var c=this[0];return!c||!c.getContext?[]:K(c).layers};d.fn.getLayer=function(c){var a=this.getLayers(),b=d.type(c),e,i;if(c&&c.layer)e=c;else if("number"===b)0>c&&(c=a.length+c),e=a[c];else for(i=0;i<a.length;i+=1)if(a[i].index=i,a[i].name===c||"regexp"===b&&a[i].name.match(c)){e=a[i];break}return e};d.fn.setLayer=function(c,a){var b,e;for(b=0;b<this.length;b+=1)(e=d(this[b]).getLayer(c))&&y(e,
a);return this};d.fn.moveLayer=function(c,a){var b,e,i;for(e=0;e<this.length;e+=1)if(b=d(this[e]),i=b.getLayers(),b=b.getLayer(c))i.splice(b.index,1),i.splice(a,0,b),b.index=a;return this};d.fn.removeLayer=function(c){var a,b,e;for(b=0;b<this.length;b+=1)a=d(this[b]),e=a.getLayers(),(a=a.getLayer(c))&&e.splice(a.index,1);return this};d.fn.removeLayers=function(){var c,a;for(c=0;c<this.length;c+=1)a=d(this[c]).getLayers(),a.length=0;return this};d.fn.getLayerGroup=function(c){var a=this.getLayers(),
b=d.type(c),e=[],i;if("array"===b)return c;for(i=0;i<a.length;i+=1)a[i].index=i,(a[i].group===c||"regexp"===b&&a[i].group.match(c))&&e.push(a[i]);return e};d.fn.setLayerGroup=function(c,a){var b,e,i;for(e=0;e<this.length;e+=1){b=d(this[e]);b=b.getLayerGroup(c);for(i=0;i<b.length;i+=1)y(b[i],a)}return this};d.fn.removeLayerGroup=function(c){var a,b,e=d.type(c),i;if(c!==s)for(b=0;b<this.length;b+=1){a=d(this[b]);a=a.getLayers();for(i=0;i<a.length;i+=1)if(a[i].index=i,a[i].group===c||"regexp"===e&&a[i].group.match(c))a.splice(i,
1),i-=1}return this};d.fn.drawLayer=function(c){var a,b,e,i;for(a=0;a<this.length;a+=1)e=d(this[a]),b=A(this[a]),i=e.getLayer(c),ha(e,b,i);return this};d.fn.drawLayers=function(c){var a,b,e,i,g,B,C,o,u;for(b=0;b<this.length;b+=1)if(a=d(this[b]),e=A(this[b])){K(this[b]);a.clearCanvas();E.canvas===this[b]?C=E.data:(C=K(this[b]),E.canvas=this[b],E.data=C);i=C.layers;for(B=0;B<i.length;B+=1)if(g=i[B],g.index=B,c&&(g._fired=F),g._event=!g.disableEvents,ha(a,e,g),g._mousedout)g._mousedout=F,g._fired=t,
g._hovered=F,g.mouseout&&g.mouseout.call(this[b],g),g.cursor&&g._cursor&&a.css({cursor:g._cursor});g=C.intersects[C.intersects.length-1]||{};e=C.event;B=e.type;g[B]||aa[B]&&(B=aa[B]);u=g[B];o=C.drag;if(g._event){if((g.mouseover||g.mouseout||g.cursor)&&!g._hovered&&!g._fired)g._fired=t,g._hovered=t,g.mouseover&&g.mouseover.call(this[b],g),g.cursor&&(g._cursor=a.css("cursor"),a.css({cursor:g.cursor}));u&&!g._fired&&(g._fired=t,u.call(this[b],g),e.type=f);if(g.draggable&&!g.disableDrag&&("mousedown"===
B||"touchstart"===B))g.bringToFront&&(i.splice(g.index,1),g.index=i.push(g)),o.layer=g,o.dragging=t,o.startX=g.x,o.startY=g.y,o.endX=g._eventX,o.endY=g._eventY,g.dragstart&&g.dragstart.call(this[b],g)}if(o.layer){if(o.dragging&&("mouseup"===B||"touchend"===B))o.layer.dragstop&&o.layer.dragstop.call(this[b],o.layer),C.drag={};if(o.dragging&&("mousemove"===B||"touchmove"===B))o.layer.x=o.layer._eventX-(o.endX-o.startX),o.layer.y=o.layer._eventY-(o.endY-o.startY),o.layer.drag&&o.layer.drag.call(this[b],
o.layer)}C.intersects=[]}return this};d.fn.addLayer=function(c){var a,b,c=c||{};for(a=0;a<this.length;a+=1)if(b=A(this[a]))c.layer=t,c.type&&!c.method&&(c.method=d.fn[na[c.type]]),c=H(this[a],{},c,c.method);return this};O=["width","height","opacity","lineHeight"];Z={};d.fn.animateLayer=function(){function c(a,b){return function(){ia(b);a.drawLayers();g[4]&&g[4].call(a[0],b)}}function a(a,b){return function(c,e){ia(b);a.drawLayers();g[5]&&g[5].call(a[0],c,e,b)}}var b,e,i,g=[].slice.call(arguments,
0);"object"===typeof g[0]&&!g[0].layer&&g.unshift(0);"object"===typeof g[2]?(g.splice(2,0,g[2].duration||f),g.splice(3,0,g[3].easing||f),g.splice(4,0,g[4].complete||f),g.splice(5,0,g[5].step||f)):(g[2]===s?(g.splice(2,0,f),g.splice(3,0,f),g.splice(4,0,f)):"function"===typeof g[2]&&(g.splice(2,0,f),g.splice(3,0,f)),g[3]===s)?(g[3]=f,g.splice(4,0,f)):"function"===typeof g[3]&&g.splice(3,0,f);g[1]=y({},g[1]);for(e=0;e<this.length;e+=1)if(b=d(this[e]),i=A(this[e]))if(K(this[e]),(i=b.getLayer(g[0]))&&
i.method!==d.fn.draw)ja(i),ja(g[1],t),i.style=Z,d(i).animate(g[1],{duration:g[2],easing:d.easing[g[3]]?g[3]:f,complete:c(b,i),step:a(b,i)});return this};d.fn.animateLayerGroup=function(c){var a,b,e=[].slice.call(arguments,0),i,g;for(b=0;b<this.length;b+=1){a=d(this[b]);i=a.getLayerGroup(c);for(g=0;g<i.length;g+=1)a.animateLayer.apply(a,[i[g]].concat(e.slice(1)))}};d.fn.delayLayer=function(c,a){var b,e,a=a||0;for(b=0;b<this.length;b+=1)e=d(this[b]).getLayer(c),d(e).delay(a);return this};d.fn.delayLayerGroup=
function(c,a){var b,e,i,g,a=a||0;for(e=0;e<this.length;e+=1){b=d(this[e]);i=b.getLayerGroup(c);for(g=0;g<i.length;g+=1)b.delayLayer.call(b,i[g],a)}};d.fn.stopLayer=function(c,a){var b,e;for(b=0;b<this.length;b+=1)e=d(this[b]).getLayer(c),d(e).stop(a);return this};d.fn.stopLayerGroup=function(c,a){var b,e,i,g;for(e=0;e<this.length;e+=1){b=d(this[e]);i=b.getLayerGroup(c);for(g=0;g<i.length;g+=1)b.stopLayer.call(b,i[g],a)}};(function(c){var a;for(a=0;a<c.length;a+=1)d.fx.step[c[a]]=oa})("color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "));
$={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"};aa={touchstart:"mousedown",touchend:"mouseup",touchmove:"mousemove"};N("click");N("dblclick");N("mousedown");N("mouseup");N("mousemove");N("mouseover");N("mouseout");N("touchstart");N("touchmove");N("touchend");d.event.fix=function(c){var a,b,c=pa.call(d.event,c);if(a=c.originalEvent)if(b=a.changedTouches,c.pageX!==s&&c.offsetX===s){if(a=d(c.target).offset())c.offsetX=c.pageX-a.left,c.offsetY=c.pageY-a.top}else if(b&&(a=d(a.target).offset()))c.offsetX=
b[0].pageX-a.left,c.offsetY=b[0].pageY-a.top;return c};na={arc:"drawArc",bezier:"drawBezier",circle:"drawArc",ellipse:"drawEllipse","function":"draw",image:"drawImage",line:"drawLine",polygon:"drawPolygon",quadratic:"drawQuadratic",rectangle:"drawRect",text:"drawText",vector:"drawVector"};d.fn.draw=function a(b){var e,i,b=b||{};"function"===typeof b&&(b={fn:b});for(e=0;e<this.length;e+=1)if((i=A(this[e]))&&b.fn)b=H(this[e],{},b,a),b.fn.call(this[e],i);return this};d.fn.clearCanvas=function(a){for(var b,
e=y(new D,a),a=0;a<this.length;a+=1)if(b=A(this[a]))I(b,e,e.width,e.height),b.setTransform(1,0,0,1,0,0),!e.x||!e.y||!e.width||!e.height?b.clearRect(0,0,this[a].width,this[a].height):b.clearRect(e.x-e.width/2,e.y-e.height/2,e.width,e.height),b.restore();return this};d.fn.saveCanvas=function(){var a,b,e;for(a=0;a<this.length;a+=1)if(b=A(this[a]))e=K(this[a]),b.save(),e.savedTransforms=y({},e.transforms);return this};d.fn.restoreCanvas=function(){var a,b,e;for(a=0;a<this.length;a+=1)if(b=A(this[a]))e=
K(this[a]),b.restore(),e.transforms=y({},e.savedTransforms);return this};d.fn.restoreCanvasOnRedraw=function(){return this.draw({layer:t,fn:function(){d(this).restoreCanvas()}})};d.fn.translateCanvas=function(a){for(var b,e=y(new D,a),i,a=0;a<this.length;a+=1)if(b=A(this[a]))i=K(this[a]),e.autosave&&b.save(),ga(b,e,i.transforms);return this};d.fn.scaleCanvas=function(a){for(var b,e=y(new D,a),i,a=0;a<this.length;a+=1)if(b=A(this[a]))i=K(this[a]),e.autosave&&b.save(),fa(b,e,i.transforms);return this};
d.fn.rotateCanvas=function(a){for(var b,e=y(new D,a),i,a=0;a<this.length;a+=1)if(b=A(this[a]))i=K(this[a]),e.autosave&&b.save(),ea(b,e,i.transforms);return this};d.fn.drawRect=function b(e){var i,g,d=y(new D,e),f,o,u,x,r;for(i=0;i<this.length;i+=1)if(g=A(this[i]))e=H(this[i],d,e,b),J(g,d),I(g,d,d.width,d.height),g.beginPath(),f=d.x-d.width/2,o=d.y-d.height/2,(r=d.cornerRadius)?(d.closed=t,u=d.x+d.width/2,x=d.y+d.height/2,0>u-f-2*r&&(r=(u-f)/2),0>x-o-2*r&&(r=(x-o)/2),g.moveTo(f+r,o),g.lineTo(u-r,o),
g.arc(u-r,o+r,r,3*z/2,2*z,F),g.lineTo(u,x-r),g.arc(u-r,x-r,r,0,z/2,F),g.lineTo(f+r,x),g.arc(f+r,x-r,r,z/2,z,F),g.lineTo(f,o+r),g.arc(f+r,o+r,r,z,3*z/2,F)):g.rect(f,o,d.width,d.height),d._event&&L(this[i],g,d),M(this[i],g,d);return this};d.fn.drawArc=function e(i){var g,d,f=y(new D,i),i=i||{};!f.inDegrees&&360===f.end&&(i.end=f.end=2*z);for(g=0;g<this.length;g+=1)if(d=A(this[g]))i=H(this[g],f,i,e),J(d,f),I(d,f,2*f.radius),d.beginPath(),d.arc(f.x,f.y,f.radius,f.start*f._toRad-z/2,f.end*f._toRad-z/2,
f.ccw),f._event&&L(this[g],d,f),M(this[g],d,f);return this};d.fn.drawEllipse=function i(g){var d,f,o=y(new D,g),u=4*o.width/3,x=o.height;o.closed=t;for(d=0;d<this.length;d+=1)if(f=A(this[d]))g=H(this[d],o,g,i),J(f,o),I(f,o,o.width,o.height),f.beginPath(),f.moveTo(o.x,o.y-x/2),f.bezierCurveTo(o.x-u/2,o.y-x/2,o.x-u/2,o.y+x/2,o.x,o.y+x/2),f.bezierCurveTo(o.x+u/2,o.y+x/2,o.x+u/2,o.y-x/2,o.x,o.y-x/2),o._event&&L(this[d],f,o),M(this[d],f,o);return this};d.fn.drawPolygon=function g(d){var f,o,u=y(new D,
d),x=2*z/u.sides,r=z/u.sides,p=r+z/2,m=u.radius*Q(x/2),j,k,n;d.closed=u.closed=t;for(f=0;f<this.length;f+=1)if(o=A(this[f])){d=H(this[f],u,d,g);J(o,u);I(o,u,2*u.radius);o.beginPath();for(n=0;n<u.sides;n+=1)j=u.x+S(u.radius*Q(p)),k=u.y+S(u.radius*T(p)),o.lineTo(j,k),u.projection&&(j=u.x+S((m+m*u.projection)*Q(p+r)),k=u.y+S((m+m*u.projection)*T(p+r)),o.lineTo(j,k)),p+=x;u._event&&L(this[f],o,u);M(this[f],o,u)}return this};d.fn.drawLine=function B(d){var f,u,x=y(new D,d),r,p,m;for(f=0;f<this.length;f+=
1)if(u=A(this[f])){d=H(this[f],x,d,B);J(u,x);X(x);I(u,x,0);r=1;for(u.beginPath();t;)if(p=x["x"+r],m=x["y"+r],p!==s&&m!==s)u.lineTo(p,m),r+=1;else break;x._event&&L(this[f],u,x);M(this[f],u,x)}return this};d.fn.drawQuadratic=d.fn.drawQuad=function C(d){var f,x,r=y(new D,d),p,m,j,k,n;for(f=0;f<this.length;f+=1)if(x=A(this[f])){d=H(this[f],r,d,C);J(x,r);X(r);I(x,r,0);p=2;x.beginPath();for(x.moveTo(r.x1,r.y1);t;)if(m=r["x"+p],j=r["y"+p],k=r["cx"+(p-1)],n=r["cy"+(p-1)],m!==s&&j!==s&&k!==s&&n!==s)x.quadraticCurveTo(k,
n,m,j),p+=1;else break;r._event&&L(this[f],x,r);M(this[f],x,r)}return this};d.fn.drawBezier=function o(d){var f,r,p=y(new D,d),m,j,k,n,q,l,h,v;for(f=0;f<this.length;f+=1)if(r=A(this[f])){d=H(this[f],p,d,o);J(r,p);X(p);I(r,p,0);m=2;j=1;r.beginPath();for(r.moveTo(p.x1,p.y1);t;)if(k=p["x"+m],n=p["y"+m],q=p["cx"+j],l=p["cy"+j],h=p["cx"+(j+1)],v=p["cy"+(j+1)],k!==s&&n!==s&&q!==s&&l!==s&&h!==s&&v!==s)r.bezierCurveTo(q,l,h,v,k,n),m+=1,j+=2;else break;p._event&&L(this[f],r,p);M(this[f],r,p)}return this};
d.fn.drawVector=function u(d){var f,p,m=y(new D,d),j,k,n,q,l;for(f=0;f<this.length;f+=1)if(p=A(this[f])){d=H(this[f],m,d,u);J(p,m);I(p,m,0);j=1;p.beginPath();q=m.x;l=m.y;for(p.moveTo(m.x,m.y);t;)if(k=m["a"+j],n=m["l"+j],k!==s&&n!==s)k=k*m._toRad-z/2,q+=n*P.cos(k),l+=n*P.sin(k),p.lineTo(q,l),j+=1;else break;m._event&&L(this[f],p,m);M(this[f],p,m)}return this};d.fn.drawGraph=function x(d){var p,m,j=y(new D,d),k,n,q,l,h;for(p=0;p<this.length;p+=1)if((m=A(this[p]))&&j.fn){d=H(this[p],j,d,x);J(m,j);k=
j.graph;n=j.domain;q=j.range;l=this[p].width;h=this[p].height;n===f&&(n=[f,f]);n[0]===f&&(n[0]=0);n[1]===f&&(n[1]=l);q===f&&(q=[f,f]);q[0]===f&&(q[0]=0);q[1]===f&&(q[1]=h);U(p,m,j,n,q);if("y"===k)for(k=n[0]-j.x;k<=n[1]-j.x;k+=1)h=j.fn(k),h===f?(V(this[p],m,j),U(p,m,j,n,q)):m.lineTo(k+j.x,h+j.y);else if("x"===k)for(h=q[0]-j.y;h<=q[1]-j.y;h+=1)k=j.fn(h),k===f?(V(this[p],m,j),U(p,m,j,n,q)):m.lineTo(k+j.x,h+j.y);else if("r"===k)for(l=0;l<2*z;l+=z/180)h=j.fn(l),k=h*Q(l),h*=T(l),k===f||h===f?(V(this[p],
m,j),U(m,j,n,q)):m.lineTo(k+j.x,h+j.y);V(this[p],m,j)}};d.fn.drawText=function r(p){var m,j,k=y(new D,p),n,q,l,h;for(m=0;m<this.length;m+=1)if(d(this[m]),j=A(this[m])){p=H(this[m],k,p,r);J(j,k);j.textBaseline=k.baseline;j.textAlign=k.align;la(j,k);if(!m&&k.maxWidth!==f){n=j;q=k.text;h=k.maxWidth;var v=q.split(" "),t=[],s="";if(n.measureText(q).width<h||1===v.length)t=[q];else{for(w=0;w<v.length;w+=1)n.measureText(s+v[w]).width>h&&(""!==s&&t.push(s),s=""),s+=v[w],w!==v.length-1&&(s+=" ");t.push(s)}n=
t;n=n.join("\n").replace(/( (\n))|( $)/gi,"$2").split("\n")}else m||(n=(""+k.text).split("\n"));ma(this[m],m,j,k,n);I(j,k,k.width,k.height);m||(l=k.x,"left"===k.align?l-=k.width/2:"right"===k.align&&(l+=k.width/2));for(q=0;q<n.length;q+=1)j.shadowColor=k.shadowColor,h=k.y+q*k.height/n.length-(n.length-1)*k.height/n.length/2,j.fillText(n[q],l,h),"transparent"!==k.fillStyle&&(j.shadowColor="transparent"),j.strokeText(n[q],l,h);k._event?(j.beginPath(),j.rect(k.x-k.width/2,k.y-k.height/2,k.width,k.height),
j.restore(),L(this[m],j,k),j.closePath()):j.restore()}E=k;return this};d.fn.measureText=function(d){var f;f=d!==s&&("object"!==typeof d||d.layer)?this.getLayer(d):y(new D,d);if((d=A(this[0]))&&f.text!==s)la(d,f),ma(this[0],0,d,f,f.text.split("\n"));return f};d.fn.drawImage=function p(d){function j(p,j,l){return function(){j||((t=v.width/v.height,h.width===f&&h.sWidth===f&&(d.width=h.width=h.sWidth=v.width),h.height===f&&h.sHeight===f&&(d.height=h.height=h.sHeight=v.height),h.width===f&&h.sWidth!==
f&&(h.width=h.sWidth),h.height===f&&h.sHeight!==f&&(h.height=h.sHeight),h.sWidth===f&&h.width!==f&&(d.sWidth=h.sWidth=v.width),h.sHeight===f&&h.height!==f&&(d.sHeight=h.sHeight=v.height),h.sx===f&&(h.sx=h.cropFromCenter?v.width/2:0),h.sy===f&&(h.sy=h.cropFromCenter?v.height/2:0),h.cropFromCenter||(h.sx+=h.sWidth/2,h.sy+=h.sHeight/2),h.sx+h.sWidth/2>v.width&&(h.sx=v.width-h.sWidth/2),0>h.sx-h.sWidth/2&&(h.sx=h.sWidth/2),0>h.sy-h.sHeight/2&&(h.sy=h.sHeight/2),h.sy+h.sHeight/2>v.height&&(h.sy=v.height-
h.sHeight/2),h.width!==f&&h.height===f)?d.height=h.height=h.width/t:h.width===f&&h.height!==f?d.width=h.width=h.height*t:h.width===f&&h.height===f&&(d.width=h.width=v.width,d.height=h.height=v.height));I(l,h,h.width,h.height);l.drawImage(v,h.sx-h.sWidth/2,h.sy-h.sHeight/2,h.sWidth,h.sHeight,h.x-h.width/2,h.y-h.height/2,h.width,h.height);l.fillStyle="transparent";l.beginPath();l.rect(h.x-h.width/2,h.y-h.height/2,h.width,h.height);h._event&&L(k[j],l,h);M(k[j],l,h);h.load&&h.load.call(p,d)}}var k=this,
n,q,l,h=y(new D,d),v,s,t;s=h.source.getContext;h.source.src||s?(v=h.source,h.width=v.width,h.height=v.height):h.source&&(v=new ba,v.src=h.source);for(q=0;q<k.length;q+=1)if(n=k[q],l=A(k[q]))d=H(k[q],h,d,p),J(l,h),v&&(v.complete||s?j(n,q,l)():(v.onload=j(n,q,l),v.src=v.src));return k};d.fn.createPattern=d.fn.pattern=function(d){function m(){l=k.createPattern(q,n.repeat);n.load&&n.load.call(j[0],l)}var j=this,k,n=y(new D,d),q,l;(k=A(j[0]))?"function"===typeof n.source?(q=W.createElement("canvas"),q.width=
n.width,q.height=n.height,d=A(q),n.source.call(q,d),m()):(d=n.source.getContext,n.source.src||d?q=n.source:(q=new ba,q.src=n.source),q.complete||d?m():q.onload=m):l=f;return l};d.fn.createGradient=d.fn.gradient=function(d){var m,d=y(new D,d),j=[],k,n,q,l,h,v,t;if(m=A(this[0])){d.x1=d.x1||0;d.y1=d.y1||0;d.x2=d.x2||0;d.y2=d.y2||0;m=d.r1!==f||d.r2!==f?m.createRadialGradient(d.x1,d.y1,d.r1,d.x2,d.y2,d.r2):m.createLinearGradient(d.x1,d.y1,d.x2,d.y2);for(l=1;d["c"+l]!==s;l+=1)d["s"+l]!==s?j.push(d["s"+
l]):j.push(f);k=j.length;j[0]===f&&(j[0]=0);j[k-1]===f&&(j[k-1]=1);for(l=0;l<k;l+=1){if(j[l]!==f){v=1;t=0;n=j[l];for(h=l+1;h<k;h+=1)if(j[h]!==f){q=j[h];break}else v+=1;n>q&&(j[h]=j[l])}else j[l]===f&&(t+=1,j[l]=n+t*((q-n)/v));m.addColorStop(j[l],d["c"+(l+1)])}}else m=f;return m};d.fn.setPixels=function m(d){var f,n,q,l=y(new D,d),h={},t,s,z,E;for(n=0;n<this.length;n+=1)if(f=this[n],q=A(f)){d=H(this[n],l,d,m);I(q,l,l.width,l.height);if(!l.x||!l.y||!l.width||!l.height)l.width=f.width,l.height=f.height,
l.x=l.width/2,l.y=l.height/2;t=q.getImageData(l.x-l.width/2,l.y-l.height/2,l.width,l.height);s=t.data;E=s.length;h=[];if(l.each)for(z=0;z<E;z+=4)h.r=s[z],h.g=s[z+1],h.b=s[z+2],h.a=s[z+3],l.each.call(f,h),s[z]=h.r,s[z+1]=h.g,s[z+2]=h.b,s[z+3]=h.a;q.putImageData(t,l.x-l.width/2,l.y-l.height/2);q.restore()}return this};d.fn.getCanvasImage=function(d,j){var k=this[0];return k&&k.toDataURL?k.toDataURL("image/"+d,j):f};d.support.canvas=W.createElement("canvas").getContext!==s;G.defaults=R;G.detectEvents=
L;G.closePath=M;d.jCanvas=G})(jQuery,document,Image,Math,parseFloat,!0,!1,null);

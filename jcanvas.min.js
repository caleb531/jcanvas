/*
 jCanvas v13.04.20
 Copyright 2013 Caleb Evans
 Released under the MIT license
*/
(function(d,da,ja,U,ka,q,C,g,v){function F(c){Q(this,c);return this}function M(c){c?Q(F.prototype,c):M.prefs=F.prototype=Q({},$);return this}function aa(c){return"string"===typeof c}function V(c){return"function"===typeof c}function E(c){return c&&c.getContext?c.getContext("2d"):g}function O(c,a){c.fillStyle=a.fillStyle;c.strokeStyle=a.strokeStyle;c.lineWidth=a.strokeWidth;a.rounded?(c.lineCap="round",c.lineJoin="round"):(c.lineCap=a.strokeCap,c.lineJoin=a.strokeJoin,c.miterLimit=a.miterLimit);c.shadowOffsetX=
a.shadowX;c.shadowOffsetY=a.shadowY;c.shadowBlur=a.shadowBlur;c.shadowColor=a.shadowColor;c.globalAlpha=a.opacity;c.globalCompositeOperation=a.compositing;a.imageSmoothing&&(c.webkitimageSmoothingEnabled=c.mozimageSmoothingEnabled=a.imageSmoothing)}function la(c,a,b){b.mask&&(b.autosave&&(c.save(),a.savedTransforms=Q({},a.transforms),a.transforms.masks+=1,a.transforms.withinMask=c.isPointInPath(a.event.x,a.event.y)?q:C),c.clip())}function ea(c,a,b){b.layer&&(b._args.withinMask=a.transforms.withinMask===
q||a.transforms.withinMask===g?q:C)}function R(c,a,b){b.closed&&a.closePath();a.fill();"transparent"!==b.fillStyle&&(a.shadowColor="transparent");0!==b.strokeWidth&&a.stroke();b.closed||a.closePath();b._transformed&&a.restore();if(b.mask||b.layer)c=L(c),la(a,c,b),ea(a,c,b)}function N(c,a,b,e){a._toRad=a.inDegrees?J/180:1;a._transformed=q;c.save();e===v&&(e=b);!a.fromCenter&&!a._centered&&(a.x+=b/2,a.y+=e/2,a._centered=q);a.rotate&&(a._toRad=a.inDegrees?J/180:1,c.translate(a.x,a.y),c.rotate(a.rotate*
a._toRad),c.translate(-a.x,-a.y));if(1!==a.scale||1!==a.scaleX||1!==a.scaleY)1!==a.scale&&(a.scaleX=a.scaleY=a.scale),c.translate(a.x,a.y),c.scale(a.scaleX,a.scaleY),c.translate(-a.x,-a.y);if(a.translate||a.translateX||a.translateY)a.translate&&(a.translateX=a.translateY=a.translate),c.translate(a.translateX,a.translateY)}function L(c){var a;I._canvas===c&&I._data?a=I._data:(a=d.data(c,"jCanvas"),a||(a={canvas:c,layers:[],layer:{names:{},groups:{}},intersects:[],drag:{},event:{},events:{},transforms:{rotate:0,
scaleX:1,scaleY:1,translateX:0,translateY:0,masks:0,withinMask:g},animating:C,animated:g},a.savedTransforms=Q({},a.transforms),d.data(c,"jCanvas",a)),I._canvas=c,I._data=a);return a}function ma(c,a,b){for(var e in M.events)if(M.events.hasOwnProperty(e)){var h=c,f=a,d=b,g=e;d[g]&&(g=fa(g),M.events[g](h,f),d._event=q)}}function na(c,a,b){var e,h,f;if(b.draggable||b.dragGroupWithLayer||b.cursor){e=["mousedown","mousemove","mouseup"];for(f=0;f<e.length;f+=1)h=fa(e[f]),M.events[h](c,a);a.events.mouseoutdrag||
(c.bind("mouseout.jCanvas",function(){a.drag={};c.drawLayers()}),a.events.mouseoutdrag=q);b._event=q}}function oa(c,a,b,e){c=a.layer.names;e?e.name!==v&&(aa(b.name)&&b.group!==e.group)&&delete c[b.name]:e=b;aa(e.name)&&(c[e.name]=b)}function pa(c,a,b,e){c=a.layer.groups;var h;if(e){if(e.group!==v&&(aa(b.group)&&b.group!==e.group)&&(a=c[b.group]))for(h=0;h<a.length;h+=1)if(a[h]===b){a.splice(h,1);break}}else e=b;aa(e.group)&&((a=c[e.group])||(a=c[e.group]=[]),a.push(b))}function qa(c,a,b){b&&b.visible&&
(b.method===d.fn.draw?b.fn.call(c[0],a):b.method&&b.method.call(c,b))}function K(c,a,b,e){var h,f={};a._args=b;a.canvas=c;if(a.draggable||f.group)a.layer=q,a.draggable=q;a.layer&&!a._layer&&(b=d(c),h=b.getLayers(),a.method=!a.method&&a.type?d.fn[ra[a.type]]:d.fn[a.method]||e,c=L(c),f=new F(a),oa(b,c,f),pa(b,c,f),ma(b,c,f),na(b,c,f),f.layer=q,f._layer=q,f.index===v&&(f.index=h.length),h.splice(f.index,0,f));return f}function sa(c){var a;for(a=0;a<T.length;a+=1)c[T[a]]=c["_"+T[a]]}function ta(c,a){var b;
for(b=0;b<T.length;b+=1)c["_"+T[b]]=c[T[b]],ga[T[b]]=1,a&&delete c[T[b]]}function ua(c){var a,b,e=[],h=1;c.match(/^#?\w+$/i)&&("transparent"===c&&(c="rgba(0,0,0,0)"),b=da.head,a=b.style.color,b.style.color=c,c=d.css(b,"color"),b.style.color=a);c.match(/^rgb/i)&&(e=c.match(/\d+/gi),c.match(/%/gi)&&(h=2.55),e[0]*=h,e[1]*=h,e[2]*=h,e[3]=e[3]!==v?ka(e[3]):1);return e}function za(c){var a=3,b;"object"!==typeof c.start&&(c.start=ua(c.start),c.end=ua(c.end));c.now=[];if(1!==c.start[3]||1!==c.end[3])a=4;
for(b=0;b<a;b+=1)c.now[b]=c.start[b]+(c.end[b]-c.start[b])*c.pos,3>b&&(c.now[b]=Aa(c.now[b]));1!==c.start[3]||1!==c.end[3]?c.now="rgba("+c.now.join(",")+")":(c.now.slice(0,3),c.now="rgb("+c.now.join(",")+")");c.elem.nodeName?c.elem.style[c.prop]=c.now:c.elem[c.prop]=c.now}function fa(c){"ontouchstart"in window&&ha[c]&&(c=ha[c]);return c}function S(c){M.events[c]=function(a,b){c=fa(c);var e="mouseover"===c||"mouseout"===c?"mousemove":c,h=b.event;b.events[e]||(a.bind(e+".jCanvas",function(b){h.x=b.offsetX;
h.y=b.offsetY;h.type=e;h.event=b;a.drawLayers({resetFire:q});b.preventDefault()}),b.events[e]=q)}}function P(c,a,b){var e,h,f,d;b=b._args;b._event&&(c=L(c),e=c.event,a=a.isPointInPath(e.x,e.y),h=c.transforms,b.eventX=b.mouseX=e.x,b.eventY=b.mouseY=e.y,b.event=e.event,d=c.transforms.rotate,e=b.eventX,f=b.eventY,0!==d?(b._eventX=e*W(-d)-f*X(-d),b._eventY=f*W(-d)+e*X(-d)):(b._eventX=e,b._eventY=f),b._eventX/=h.scaleX,b._eventY/=h.scaleY,!a&&(b._hovered&&!b._fired)&&(b._mousedout=q),a&&c.intersects.push(b))}
function va(c){V(c)&&(c={method:d.fn.draw,fn:c});return c}function ba(c,a,b,e,h){a.save();a.beginPath();a.rect(e[0],h[0],e[1]-e[0],h[1]-h[0]);a.clip();N(a,b,0);a.beginPath()}function ca(c,a,b){b._event&&P(c,a,b);a.restore();R(c,a,b)}function wa(c,a){a.font?c.font=a.font:(isNaN(Number(a.fontSize))||(a.fontSize+="px"),c.font=a.fontStyle+" "+a.fontSize+" "+a.fontFamily)}function xa(c,a,b,e,h){var f=/\b(\d*\.?\d*)\w\w\b/gi,w;if(I.text===e.text&&I.font===e.font&&I.fontStyle===e.fontStyle&&I.fontSize===
e.fontSize&&I.fontFamily===e.fontFamily&&I.maxWidth===e.maxWidth&&I.lineHeight===e.lineHeight)e.width=I.width,e.height=I.height;else if(!a){e.width=b.measureText(h[0]).width;for(a=1;a<h.length;a+=1)w=b.measureText(h[a]).width,w>e.width&&(e.width=w);b=c.style.fontSize;if(e.font){if(a=e.font.match(f))c.style.fontSize=e.font.match(f)[0]}else c.style.fontSize=e.fontSize;e.height=ka(d.css(c,"fontSize"))*h.length*e.lineHeight;c.style.fontSize=b}}var $,Q=d.extend,Y=d.inArray,Aa=U.round,J=U.PI,X=U.sin,W=
U.cos,Ba=d.event.fix,ha,ia,ra,I={},T,ga;d.fn.jCanvas=M;M.events={};$={align:"center",autosave:q,baseline:"middle",bringToFront:C,ccw:C,closed:C,compositing:"source-over",concavity:0,cornerRadius:0,cropFromCenter:q,disableDrag:C,disableEvents:C,domain:g,draggable:C,group:null,data:{},each:g,end:360,fillStyle:"transparent",font:"",fontStyle:"normal",fontSize:"12pt",fontFamily:"sans-serif",fromCenter:q,fn:g,graph:"y",height:g,imageSmoothing:q,inDegrees:q,lineHeight:1,layer:!1,load:g,mask:C,maxWidth:g,
miterLimit:10,name:null,opacity:1,projection:0,r1:g,r2:g,radius:0,range:g,repeat:"repeat",rotate:0,rounded:C,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowX:0,shadowY:0,sHeight:g,sides:0,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:g,sx:g,sy:g,text:"",translate:0,translateX:0,translateY:0,type:g,visible:q,width:g,x:0,y:0};M();M.extend=function(c){M.defaults=Q($,c.props);M();c.name&&(d.fn[c.name]=function b(e){var h,f,
d,g=new F(e);for(f=0;f<this.length;f+=1)if(h=this[f],d=E(h))e=K(h,g,e,b),O(d,g),c.fn.call(h,d,g);return this});return d.fn[c.name]};d.fn.getLayers=function(c){var a=this[0],b,e,h=[];if(a&&a.getContext)if(b=L(a).layers,V(c))for(e=0;e<b.length;e+=1)c.call(a,b[e])&&h.push(b[e]);else h=b;return h};d.fn.getLayer=function(c){var a=this.getLayers(),b=d.type(c),e=L(this[0]),h;if(c&&c.layer)h=c;else if("number"===b)0>c&&(c=a.length+c),h=a[c];else if("regexp"===b)for(b=0;b<a.length;b+=1){if(a[b].name.match(c)){h=
a[b];break}}else e=L(this[0]),h=e.layer.names[c];return h};d.fn.getLayerIndex=function(c){var a=this.getLayers();c=this.getLayer(c);return Y(c,a)};d.fn.setLayer=function(c,a){var b,e,h,f;for(e=0;e<this.length;e+=1)if(b=d(this[e]),h=L(this[e]),f=d(this[e]).getLayer(c))oa(b,h,f,a),pa(b,h,f,a),Q(f,a),ma(b,h,f),na(b,h,f);return this};d.fn.setLayers=function(c){var a,b,e,h;for(b=0;b<this.length;b+=1){a=d(this[b]);e=d(this[b]).getLayers();for(h=0;h<e.length;h+=1)a.setLayer(e[h],c)}return this};d.fn.moveLayer=
function(c,a){var b,e,h;for(e=0;e<this.length;e+=1)if(b=d(this[e]),h=b.getLayers(),b=b.getLayer(c))b.index=Y(b,h),h.splice(b.index,1),h.splice(a,0,b),0>a&&(a=h.length+a),b.index=a;return this};d.fn.removeLayer=function(c){var a,b,e;for(b=0;b<this.length;b+=1)if(a=d(this[b]),e=a.getLayers(),a=a.getLayer(c))a.index=Y(a,e),e.splice(a.index,1);return this};d.fn.removeLayers=function(){var c,a;for(a=0;a<this.length;a+=1)c=d(this[a]),c=c.getLayers(),c.length=0;return this};d.fn.getLayerGroup=function(c){var a=
this.getLayers(),b=d.type(c),e=[];if("array"===b)return c;if("regexp"===b)for(b=0;b<a.length;b+=1)a[b].index=b,a[b].group.match(c)&&e.push(a[b]);else a=L(this[0]),e=a.layer.groups[c];return e};d.fn.setLayerGroup=function(c,a){var b,e,h,f;for(e=0;e<this.length;e+=1)if(b=d(this[e]),h=b.getLayerGroup(c))for(f=0;f<h.length;f+=1)b.setLayer(h[f],a);return this};d.fn.removeLayerGroup=function(c){var a,b,e=d.type(c),h;if(c!==v)for(b=0;b<this.length;b+=1){a=d(this[b]);a=a.getLayers();for(h=0;h<a.length;h+=
1)if((void 0).index=Y(void 0,a),a[h].group===c||"regexp"===e&&a[h].group.match(c))a.splice(h,1),h-=1}return this};d.fn.drawLayer=function(c){var a,b,e,h;for(a=0;a<this.length;a+=1)e=d(this[a]),b=E(this[a]),h=e.getLayer(c),qa(e,b,h);return this};d.fn.drawLayers=function(c){var a,b,e=c||{},h,f,w,G,t,B;e.index===v&&(e.index=0);for(c=0;c<this.length;c+=1)if(a=d(this[c]),b=E(this[c])){G=L(this[c]);for(f=0;f<G.transforms.masks;f+=1)a.restoreCanvas();e.clear!==C&&a.clearCanvas();h=G.layers;for(w=e.index;w<
h.length&&!(f=h[w],f.index=w,e.resetFire&&(f._fired=C),f._event=!f.disableEvents,qa(a,b,f),f._mousedout&&(f._mousedout=C,f._fired=q,f._hovered=C,f.mouseout&&f.mouseout.call(this[c],f),f.cursor&&f._cursor&&a.css({cursor:f._cursor})),f.method===d.fn.drawImage);w+=1);for(f=0;f<G.transforms.masks;f+=1)a.restoreCanvas();f=G.intersects[G.intersects.length-1]||{};w=G.event;b=w.type;f[b]||ia[b]&&(b=ia[b]);B=f[b];t=G.drag;if(f._event&&f.withinMask===q){if((f.mouseover||f.mouseout||f.cursor)&&!f._hovered&&
!f._fired)f._fired=q,f._hovered=q,f.mouseover&&f.mouseover.call(this[c],f),f.cursor&&(f._cursor=a.css("cursor"),a.css({cursor:f.cursor}));B&&!f._fired&&(f._fired=q,B.call(this[c],f),w.type=g);if(f.draggable&&!f.disableDrag&&("mousedown"===b||"touchstart"===b)){f.bringToFront&&(h.splice(f.index,1),f.index=h.push(f));t.layer=f;t.dragging=q;if(t.layer.group&&t.layer.dragGroupWithLayer&&(a=G.layer.groups[t.layer.group]))for(w=0;w<a.length;w+=1)a[w]!==t.layer&&(a[w]._startX=a[w].x,a[w]._startY=a[w].y,
a[w]._endX=f._eventX,a[w]._endY=f._eventY,a[w].bringToFront&&(a[w].index=Y(a[w],h),h.splice(a[w].index,1),h.splice(-1,0,a[w]),a[w].index=h.length-2));t._startX=f._startX=f.x;t._startY=f._startY=f.y;t._endX=f._endX=f._eventX;t._endY=f._endY=f._eventY;f.dragstart&&f.dragstart.call(this[c],f)}}if(t.layer){if(t.dragging&&("mouseup"===b||"touchend"===b))t.layer.dragstop&&t.layer.dragstop.call(this[c],t.layer),G.drag={};if(t.dragging&&("mousemove"===b||"touchmove"===b))if(t.layer.x=t.layer._eventX-(t._endX-
t._startX),t.layer.y=t.layer._eventY-(t._endY-t._startY),t.layer.drag&&t.layer.drag.call(this[c],t.layer),t.layer.group&&t.layer.dragGroupWithLayer&&(a=G.layer.groups[t.layer.group]))for(w=0;w<a.length;w+=1)a[w]!==t.layer&&(a[w].x=t.layer._eventX-(a[w]._endX-a[w]._startX),a[w].y=t.layer._eventY-(a[w]._endY-a[w]._startY))}G.intersects=[]}return this};d.fn.addLayer=function(c){var a,b,e;c=va(c);e=new F(c);for(a=0;a<this.length;a+=1)if(b=E(this[a]))e.layer=q,c=K(this[a],e,c);return this};T=["width",
"height","opacity","lineHeight"];ga={};d.fn.animateLayer=function(){function c(a,b,c){return function(){sa(c);(!b.animating||b.animated===c)&&a.drawLayers();f[4]&&f[4].call(a[0],c);c._animating=C;b.animating=C;b.animated=g}}function a(a,b,c){return function(e,h){sa(c);!c._animating&&!b.animating&&(c._animating=q,b.animating=q,b.animated=c);(!b.animating||b.animated===c)&&a.drawLayers();f[5]&&f[5].call(a[0],e,h,c)}}var b,e,h,f=[].slice.call(arguments,0),w,G;"object"===typeof f[0]&&!f[0].layer&&f.unshift(0);
"object"===typeof f[2]?(f.splice(2,0,f[2].duration||g),f.splice(3,0,f[3].easing||g),f.splice(4,0,f[4].complete||g),f.splice(5,0,f[5].step||g)):(f[2]===v?(f.splice(2,0,g),f.splice(3,0,g),f.splice(4,0,g)):V(f[2])&&(f.splice(2,0,g),f.splice(3,0,g)),f[3]===v?(f[3]=g,f.splice(4,0,g)):V(f[3])&&f.splice(3,0,g));for(e=0;e<this.length;e+=1)if(b=d(this[e]),h=E(this[e]))if(h=L(this[e]),(w=b.getLayer(f[0]))&&w.method!==d.fn.draw){G=Q({},f[1]);var t=this[e],B=w,x=void 0;for(x in G)G.hasOwnProperty(x)&&V(G[x])&&
(G[x]=G[x].call(t,B,x));ta(G,q);ta(w);w.style=ga;d(w).animate(G,{duration:f[2],easing:d.easing[f[3]]?f[3]:g,complete:c(b,h,w),step:a(b,h,w)})}return this};d.fn.animateLayerGroup=function(c){var a,b,e=[].slice.call(arguments,0),h,f;for(b=0;b<this.length;b+=1){a=d(this[b]);h=a.getLayerGroup(c);for(f=0;f<h.length;f+=1)a.animateLayer.apply(a,[h[f]].concat(e.slice(1)))}};d.fn.delayLayer=function(c,a){var b,e;a=a||0;for(b=0;b<this.length;b+=1)e=d(this[b]).getLayer(c),d(e).delay(a);return this};d.fn.delayLayerGroup=
function(c,a){var b,e,h,f;a=a||0;for(e=0;e<this.length;e+=1){b=d(this[e]);h=b.getLayerGroup(c);for(f=0;f<h.length;f+=1)b.delayLayer.call(b,h[f],a)}};d.fn.stopLayer=function(c,a){var b,e;for(b=0;b<this.length;b+=1)e=d(this[b]).getLayer(c),d(e).stop(a);return this};d.fn.stopLayerGroup=function(c,a){var b,e,h,f;for(e=0;e<this.length;e+=1){b=d(this[e]);h=b.getLayerGroup(c);for(f=0;f<h.length;f+=1)b.stopLayer.call(b,h[f],a)}};var ya="color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "),
Z;for(Z=0;Z<ya.length;Z+=1)d.fx.step[ya[Z]]=za;ha={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"};ia={touchstart:"mousedown",touchend:"mouseup",touchmove:"mousemove"};S("click");S("dblclick");S("mousedown");S("mouseup");S("mousemove");S("mouseover");S("mouseout");S("touchstart");S("touchmove");S("touchend");d.event.fix=function(c){var a,b;c=Ba.call(d.event,c);if(a=c.originalEvent)if(b=a.changedTouches,c.pageX!==v&&c.offsetX===v){if(a=d(c.target).offset())c.offsetX=c.pageX-a.left,
c.offsetY=c.pageY-a.top}else if(b&&(a=d(a.target).offset()))c.offsetX=b[0].pageX-a.left,c.offsetY=b[0].pageY-a.top;return c};ra={arc:"drawArc",bezier:"drawBezier",circle:"drawArc",ellipse:"drawEllipse","function":"draw",image:"drawImage",line:"drawLine",polygon:"drawPolygon",quadratic:"drawQuadratic",rectangle:"drawRect",text:"drawText",vector:"drawVector"};d.fn.draw=function a(b){var e,h,f;b=va(b);f=new F(b);for(e=0;e<this.length;e+=1)if((h=E(this[e]))&&f.fn)b=K(this[e],f,b,a),f.visible&&f.fn.call(this[e],
h);return this};d.fn.clearCanvas=function(a){var b,e=new F(a);for(a=0;a<this.length;a+=1)if(b=E(this[a]))!e.x||!e.y||!e.width||!e.height?(b.save(),b.setTransform(1,0,0,1,0,0),b.clearRect(0,0,this[a].width,this[a].height)):(N(b,e,e.width,e.height),b.clearRect(e.x-e.width/2,e.y-e.height/2,e.width,e.height)),b.restore();return this};d.fn.saveCanvas=function(){var a,b,e;for(a=0;a<this.length;a+=1)if(b=E(this[a]))e=L(this[a]),b.save(),e.savedTransforms=Q({},e.transforms);return this};d.fn.restoreCanvas=
function(){var a,b,e;for(a=0;a<this.length;a+=1)if(b=E(this[a]))e=L(this[a]),b.restore(),e.transforms=Q({},e.savedTransforms);return this};d.fn.restoreCanvasOnRedraw=function(a){var b={layer:q,fn:function(){d(this).restoreCanvas()}};Q(b,a);return this.draw(b)};d.fn.translateCanvas=function b(e){var h,f,d=new F(e),g;for(h=0;h<this.length;h+=1)if(f=E(this[h]))g=L(this[h]),e=K(this[h],d,e,b),d.autosave&&f.save(),b(f,d,g.transforms);return this};d.fn.scaleCanvas=function e(h){var f,d,g=new F(h),t;for(f=
0;f<this.length;f+=1)if(d=E(this[f]))t=L(this[f]),h=K(this[f],g,h,e),g.autosave&&d.save(),e(d,g,t.transforms);return this};d.fn.rotateCanvas=function h(f){var d,g,t=new F(f),B;for(d=0;d<this.length;d+=1)if(g=E(this[d]))B=L(this[d]),f=K(this[d],t,f,h),t.autosave&&g.save(),h(g,t,B.transforms);return this};d.fn.drawRect=function f(d){var g,t,B=new F(d),x,z,y,A,s;for(g=0;g<this.length;g+=1)if(t=E(this[g]))d=K(this[g],B,d,f),B.visible&&(O(t,B),N(t,B,B.width,B.height),t.beginPath(),x=B.x-B.width/2,z=B.y-
B.height/2,(s=B.cornerRadius)?(B.closed=q,y=B.x+B.width/2,A=B.y+B.height/2,0>y-x-2*s&&(s=(y-x)/2),0>A-z-2*s&&(s=(A-z)/2),t.moveTo(x+s,z),t.lineTo(y-s,z),t.arc(y-s,z+s,s,3*J/2,2*J,C),t.lineTo(y,A-s),t.arc(y-s,A-s,s,0,J/2,C),t.lineTo(x+s,A),t.arc(x+s,A-s,s,J/2,J,C),t.lineTo(x,z+s),t.arc(x+s,z+s,s,J,3*J/2,C)):t.rect(x,z,B.width,B.height),B._event&&P(this[g],t,B),R(this[g],t,B));return this};d.fn.drawArc=function w(d){var g,B,x=new F(d);d=d||{};x.layer&&(!x.inDegrees&&360===x.end)&&(d.end=x.end=2*J);
for(g=0;g<this.length;g+=1)if(B=E(this[g]))d=K(this[g],x,d,w),x.visible&&(O(B,x),N(B,x,2*x.radius),B.beginPath(),B.arc(x.x,x.y,x.radius,x.start*x._toRad-J/2,x.end*x._toRad-J/2,x.ccw),x._event&&P(this[g],B,x),R(this[g],B,x));return this};d.fn.drawEllipse=function G(d){var g,x,z=new F(d),y=4*z.width/3,A=z.height;z.closed=q;for(g=0;g<this.length;g+=1)if(x=E(this[g]))d=K(this[g],z,d,G),z.visible&&(O(x,z),N(x,z,z.width,z.height),x.beginPath(),x.moveTo(z.x,z.y-A/2),x.bezierCurveTo(z.x-y/2,z.y-A/2,z.x-y/
2,z.y+A/2,z.x,z.y+A/2),x.bezierCurveTo(z.x+y/2,z.y+A/2,z.x+y/2,z.y-A/2,z.x,z.y-A/2),z._event&&P(this[g],x,z),R(this[g],x,z));return this};d.fn.drawPolygon=function t(d){var g,z,y=new F(d),A=2*J/y.sides,s=J/y.sides,p=s+J/2,n=y.radius*W(A/2),k,m,r;y.closed=q;y.projection&&(y.concavity=-y.projection);for(g=0;g<this.length;g+=1)if(z=E(this[g]))if(d=K(this[g],y,d,t),y.visible){O(z,y);N(z,y,2*y.radius);z.beginPath();for(r=0;r<y.sides;r+=1)k=y.x+y.radius*W(p),m=y.y+y.radius*X(p),z.lineTo(k,m),y.concavity&&
(k=y.x+(n+-n*y.concavity)*W(p+s),m=y.y+(n+-n*y.concavity)*X(p+s),z.lineTo(k,m)),p+=A;y._event&&P(this[g],z,y);R(this[g],z,y)}return this};d.fn.drawLine=function B(d){var g,y,A=new F(d),s,p,n;for(g=0;g<this.length;g+=1)if(y=E(this[g]))if(d=K(this[g],A,d,B),A.visible){O(y,A);N(y,A,0);s=1;for(y.beginPath();q;)if(p=A["x"+s],n=A["y"+s],p!==v&&n!==v)y.lineTo(p+A.x,n+A.y),s+=1;else break;A._event&&P(this[g],y,A);R(this[g],y,A)}return this};d.fn.drawQuadratic=d.fn.drawQuad=function x(d){var g,A,s=new F(d),
p,n,k,m,r;for(g=0;g<this.length;g+=1)if(A=E(this[g]))if(d=K(this[g],s,d,x),s.visible){O(A,s);N(A,s,0);p=2;A.beginPath();for(A.moveTo(s.x1+s.x,s.y1+s.y);q;)if(n=s["x"+p],k=s["y"+p],m=s["cx"+(p-1)],r=s["cy"+(p-1)],n!==v&&k!==v&&m!==v&&r!==v)A.quadraticCurveTo(m+s.x,r+s.y,n+s.x,k+s.y),p+=1;else break;s._event&&P(this[g],A,s);R(this[g],A,s)}return this};d.fn.drawBezier=function z(d){var g,s,p=new F(d),n,k,m,r,u,l,D,j;for(g=0;g<this.length;g+=1)if(s=E(this[g]))if(d=K(this[g],p,d,z),p.visible){O(s,p);N(s,
p,0);n=2;k=1;s.beginPath();for(s.moveTo(p.x1+p.x,p.y1+p.y);q;)if(m=p["x"+n],r=p["y"+n],u=p["cx"+k],l=p["cy"+k],D=p["cx"+(k+1)],j=p["cy"+(k+1)],m!==v&&r!==v&&u!==v&&l!==v&&D!==v&&j!==v)s.bezierCurveTo(u+p.x,l+p.y,D+p.x,j+p.y,m+p.x,r+p.y),n+=1,k+=2;else break;p._event&&P(this[g],s,p);R(this[g],s,p)}return this};d.fn.drawVector=function y(d){var g,p,n=new F(d),k,m,r,u,l;for(g=0;g<this.length;g+=1)if(p=E(this[g]))if(d=K(this[g],n,d,y),n.visible){O(p,n);N(p,n,0);k=1;p.beginPath();u=n.x;l=n.y;for(p.moveTo(n.x,
n.y);q;)if(m=n["a"+k],r=n["l"+k],m!==v&&r!==v)m=m*n._toRad-J/2,u+=r*U.cos(m),l+=r*U.sin(m),p.lineTo(u,l),k+=1;else break;n._event&&P(this[g],p,n);R(this[g],p,n)}return this};d.fn.drawGraph=function A(d){var p,n,k=new F(d),m,r,u,l,D,j;for(p=0;p<this.length;p+=1)if((n=E(this[p]))&&k.fn)if(d=K(this[p],k,d,A),k.visible){O(n,k);m=k.graph;r=k.domain;u=k.range;l=this[p].width;D=this[p].height;r===g&&(r=[g,g]);r[0]===g&&(r[0]=0);r[1]===g&&(r[1]=l);u===g&&(u=[g,g]);u[0]===g&&(u[0]=0);u[1]===g&&(u[1]=D);ba(p,
n,k,r,u);if("y"===m)for(m=r[0]-k.x;m<=r[1]-k.x;m+=1)l=k.fn(m,k),l===g?(ca(this[p],n,k),ba(p,n,k,r,u)):n.lineTo(m+k.x,l+k.y);else if("x"===m)for(l=u[0]-k.y;l<=u[1]-k.y;l+=1)m=k.fn(l,k),m===g?(ca(this[p],n,k),ba(p,n,k,r,u)):n.lineTo(m+k.x,l+k.y);else if("r"===m)for(j=0;j<2*J;j+=J/180)D=k.fn(j,k),m=D*W(j),l=D*X(j),D===g?(ca(this[p],n,k),ba(n,k,r,u)):n.lineTo(m+k.x,l+k.y);ca(this[p],n,k)}};d.fn.drawText=function s(p){var n,k,m=new F(p),r,u,l,D;for(n=0;n<this.length;n+=1)if(d(this[n]),k=E(this[n]))if(p=
K(this[n],m,p,s),m.visible){O(k,m);k.textBaseline=m.baseline;k.textAlign=m.align;wa(k,m);if(!n&&m.maxWidth!==g){r=k;u=m.text;D=m.maxWidth;var j=u.split(" "),H=void 0,q=[],v="";if(r.measureText(u).width<D||1===j.length)q=[u];else{for(H=0;H<j.length;H+=1)r.measureText(v+j[H]).width>D&&(""!==v&&q.push(v),v=""),v+=j[H],H!==j.length-1&&(v+=" ");q.push(v)}r=q;r=r.join("\n").replace(/( (\n))|( $)/gi,"$2").split("\n")}else n||(r=String(m.text).split("\n"));xa(this[n],n,k,m,r);N(k,m,m.width,m.height);n||(l=
m.x,"left"===m.align?l-=m.width/2:"right"===m.align&&(l+=m.width/2));for(u=0;u<r.length;u+=1)k.shadowColor=m.shadowColor,D=m.y+u*m.height/r.length-(r.length-1)*m.height/r.length/2,k.fillText(r[u],l,D),"transparent"!==m.fillStyle&&(k.shadowColor="transparent"),k.strokeText(r[u],l,D);m._event?(k.beginPath(),k.rect(m.x-m.width/2,m.y-m.height/2,m.width,m.height),k.restore(),P(this[n],k,m),k.closePath(),ea(k,L(this[n]),m)):k.restore()}I=m;return this};d.fn.measureText=function(d){var g;g=d!==v&&("object"!==
typeof d||d.layer)?this.getLayer(d):new F(d);if((d=E(this[0]))&&g.text!==v)wa(d,g),xa(this[0],0,d,g,g.text.split("\n"));return g};d.fn.drawImage=function p(n){function k(p,k,l){return function(){0===k&&(j.width===g&&j.sWidth===g&&(j.width=j.sWidth=q.width),j.height===g&&j.sHeight===g&&(j.height=j.sHeight=q.height),n&&j.layer&&(n.width=j.width,n.height=j.height),j.sWidth!==g&&j.sHeight!==g&&j.sx!==g&&j.sy!==g?(j.width===g&&(j.width=j.sWidth),j.height===g&&(j.height=j.sHeight),j.cropFromCenter||(j.sx+=
j.sWidth/2,j.sy+=j.sHeight/2),j.sx+j.sWidth/2>q.width&&(j.sx=q.width-j.sWidth/2),0>j.sx-j.sWidth/2&&(j.sx=j.sWidth/2),0>j.sy-j.sHeight/2&&(j.sy=j.sHeight/2),j.sy+j.sHeight/2>q.height&&(j.sy=q.height-j.sHeight/2),O(l,j),N(l,j,j.width,j.height),l.drawImage(q,j.sx-j.sWidth/2,j.sy-j.sHeight/2,j.sWidth,j.sHeight,j.x-j.width/2,j.y-j.height/2,j.width,j.height)):(O(l,j),N(l,j,j.width,j.height),l.drawImage(q,j.x-j.width/2,j.y-j.height/2,j.width,j.height)));l.beginPath();l.rect(j.x-j.width/2,j.y-j.height/2,
j.width,j.height);j._event&&P(m[k],l,j);j._transformed&&l.restore();D=L(m[k]);l.closePath();l.stroke();la(l,D,j);ea(l,D,j);j.load&&j.load.call(p,n);j.layer&&d(p).drawLayers({clear:C,resetFire:!0,index:j.index+1})}}var m=this,r,u,l,D,j=new F(n),q,v;r=j.source;v=r.getContext;r.src||v?q=r:r&&(I.source===r?q=I._source:(q=new ja,q.src=r,I.source=r,I._source=q));for(u=0;u<m.length;u+=1)if(r=m[u],l=E(m[u]))n=K(m[u],j,n,p),j.visible&&q&&(q.complete||v?k(r,u,l)():(d(q).bind("load",k(r,u,l)),q.src=q.src));
return m};d.fn.createPattern=d.fn.pattern=function(p){function n(){l=m.createPattern(u,r.repeat);r.load&&r.load.call(k[0],l)}var k=this,m,r=new F(p),u,l,q;(m=E(k[0]))?(q=r.source,V(q)?(u=da.createElement("canvas"),u.width=r.width,u.height=r.height,p=E(u),q.call(u,p),n()):(p=q.getContext,q.src||p?u=q:(u=new ja,u.src=q),u.complete||p?n():(d(u).bind("load",n),u.src=u.src))):l=g;return l};d.fn.createGradient=d.fn.gradient=function(d){var n;d=new F(d);var k=[],m,r,q,l,D,j,H;if(n=E(this[0])){d.x1=d.x1||
0;d.y1=d.y1||0;d.x2=d.x2||0;d.y2=d.y2||0;n=d.r1!==g||d.r2!==g?n.createRadialGradient(d.x1,d.y1,d.r1,d.x2,d.y2,d.r2):n.createLinearGradient(d.x1,d.y1,d.x2,d.y2);for(l=1;d["c"+l]!==v;l+=1)d["s"+l]!==v?k.push(d["s"+l]):k.push(g);m=k.length;k[0]===g&&(k[0]=0);k[m-1]===g&&(k[m-1]=1);for(l=0;l<m;l+=1){if(k[l]!==g){j=1;H=0;r=k[l];for(D=l+1;D<m;D+=1)if(k[D]!==g){q=k[D];break}else j+=1;r>q&&(k[D]=k[l])}else k[l]===g&&(H+=1,k[l]=r+H*((q-r)/j));n.addColorStop(k[l],d["c"+(l+1)])}}else n=g;return n};d.fn.setPixels=
function n(d){var g,r,q,l=new F(d),v={},j,H,C,I;for(r=0;r<this.length;r+=1)if(g=this[r],q=E(g)){d=K(g,l,d,n);N(q,l,l.width,l.height);if(null===l.width||null===l.height)l.width=g.width,l.height=g.height,l.x=l.width/2,l.y=l.height/2;if(0!==l.width&&0!==l.height){j=q.getImageData(l.x-l.width/2,l.y-l.height/2,l.width,l.height);H=j.data;I=H.length;v=[];if(l.each)for(C=0;C<I;C+=4)v.r=H[C],v.g=H[C+1],v.b=H[C+2],v.a=H[C+3],l.each.call(g,v),H[C]=v.r,H[C+1]=v.g,H[C+2]=v.b,H[C+3]=v.a;q.putImageData(j,l.x-l.width/
2,l.y-l.height/2);q.restore()}}return this};d.fn.getCanvasImage=function(d,k){var m=this[0];k===v&&(k=1);return m&&m.toDataURL?m.toDataURL("image/"+d,k):g};d.support.canvas=da.createElement("canvas").getContext!==v;M.defaults=$;M.detectEvents=P;M.closePath=R;d.jCanvas=M})(jQuery,document,Image,Math,parseFloat,!0,!1,null);

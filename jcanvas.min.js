/*
 jCanvas v14.01.07
 Copyright 2014 Caleb Evans
 Released under the MIT license
*/
(function(d,ra,sa,ja,$,ta,B,z,f,E){function K(c){W(this,c);return this}function N(c){c?W(K.prototype,c):N.prefs=K.prototype=W({},ga);return this}function ha(c){return"string"===aa(c)}function J(c){return c&&c.getContext?c.getContext("2d"):f}function ia(c){c=W({},c);c.masks=c.masks.slice(0);return c}function ba(c,b){var a;c.save();a=ia(b.transforms);b.savedTransforms.push(a)}function ua(c,b,a,e){a[e]&&(Z(a[e])?b[e]=a[e].call(c,a):b[e]=a[e])}function T(c,b,a){ua(c,b,a,"fillStyle");ua(c,b,a,"strokeStyle");
b.lineWidth=a.strokeWidth;a.rounded?b.lineCap=b.lineJoin="round":(b.lineCap=a.strokeCap,b.lineJoin=a.strokeJoin,b.miterLimit=a.miterLimit);b.shadowOffsetX=a.shadowX;b.shadowOffsetY=a.shadowY;b.shadowBlur=a.shadowBlur;b.shadowColor=a.shadowColor;b.globalAlpha=a.opacity;b.globalCompositeOperation=a.compositing;a.imageSmoothing&&(b.webkitImageSmoothingEnabled=b.mozImageSmoothingEnabled=a.imageSmoothing)}function va(c,b,a){a.mask&&(a.autosave&&ba(c,b),c.clip(),b.transforms.masks.push(a._args))}function X(c,
b,a){a.closed&&b.closePath();a.shadowStroke&&0!==a.strokeWidth?(b.stroke(),b.fill(),b.shadowColor="transparent",b.shadowBlur=0,b.stroke()):(b.fill(),"transparent"!==a.fillStyle&&(b.shadowColor="transparent"),0!==a.strokeWidth&&b.stroke());a.closed||b.closePath();a._transformed&&b.restore();a.mask&&(c=F(c),va(b,c,a))}function wa(c,b,a){b._toRad=b.inDegrees?L/180:1;c.translate(b.x,b.y);c.rotate(b.rotate*b._toRad);c.translate(-b.x,-b.y);a&&(a.rotate+=b.rotate*b._toRad)}function xa(c,b,a){1!==b.scale&&
(b.scaleX=b.scaleY=b.scale);c.translate(b.x,b.y);c.scale(b.scaleX,b.scaleY);c.translate(-b.x,-b.y);a&&(a.scaleX*=b.scaleX,a.scaleY*=b.scaleY)}function ya(c,b,a){b.translate&&(b.translateX=b.translateY=b.translate);c.translate(b.translateX,b.translateY);a&&(a.translateX+=b.translateX,a.translateY+=b.translateY)}function S(c,b,a,e,g){a._toRad=a.inDegrees?L/180:1;a.arrowAngle*=a._toRad;a._transformed=B;b.save();a.fromCenter||a._centered||e===E||(g===E&&(g=e),a.x+=e/2,a.y+=g/2,a._centered=B);a.rotate&&
wa(b,a,f);1===a.scale&&1===a.scaleX&&1===a.scaleY||xa(b,a,f);(a.translate||a.translateX||a.translateY)&&ya(b,a,f)}function F(c){var b=Y.dataCache,a;b._canvas===c&&b._data?a=b._data:(a=d.data(c,"jCanvas"),a||(a={canvas:c,layers:[],layer:{names:{},groups:{}},eventHooks:{},intersecting:[],lastIntersected:f,cursor:d(c).css("cursor"),drag:{layer:f,dragging:z},event:{type:f,x:f,y:f},events:{},transforms:ia(ka),savedTransforms:[],animating:z,animated:f,pixelRatio:1,scaled:z},d.data(c,"jCanvas",a)),b._canvas=
c,b._data=a);return a}function za(c,b,a){for(var e in N.events)N.events.hasOwnProperty(e)&&(a[e]||a.cursors&&a.cursors[e])&&Aa(c,b,a,e)}function Aa(c,b,a,e){void 0!==window.ontouchstart&&la[e]&&(e=la[e]);N.events[e](c,b);a._event=B}function Ba(c,b,a){var e,g,h;if(a.draggable||a.cursors){e=["mousedown","mousemove","mouseup"];for(h=0;h<e.length;h+=1)g=e[h],Aa(c,b,a,g);b.events.mouseoutdrag||(c.bind("mouseout.jCanvas",function(){var a=b.drag.layer;a&&(b.drag={},P(c,b,a,"dragcancel"),c.drawLayers())}),
b.events.mouseoutdrag=B);a._event=B}}function ma(c,b,a,e){c=b.layer.names;e?e.name!==E&&ha(a.name)&&a.name!==e.name&&delete c[a.name]:e=a;ha(e.name)&&(c[e.name]=a)}function na(c,b,a,e){c=b.layer.groups;var g,h,M,d;if(!e)e=a;else if(e.groups!==E&&a.groups!==f)for(h=0;h<a.groups.length;h+=1)if(g=a.groups[h],b=c[g]){for(d=0;d<b.length;d+=1)if(b[d]===a){M=d;b.splice(d,1);break}0===b.length&&delete c[g]}if(e.groups!==E&&e.groups!==f)for(h=0;h<e.groups.length;h+=1)g=e.groups[h],b=c[g],b||(b=c[g]=[],b.name=
g),M===E&&(M=b.length),b.splice(M,0,a)}function oa(c,b,a,e,g){e[a]&&b._running&&!b._running[a]&&(b._running[a]=B,e[a].call(c[0],b,g),b._running[a]=z)}function P(c,b,a,e,g){if(!a.disableEvents){var h;a.cursors&&(h=a.cursors[e]);-1!==d.inArray(h,Ca)&&(h=Da.css+h);h&&c.css({cursor:h});oa(c,a,e,a,g);oa(c,a,e,b.eventHooks,g);oa(c,a,e,N.eventHooks,g)}}function O(c,b,a,e){var g=b._layer?a:b;b._args=a;b.canvas=c;if(b.draggable||b.dragGroups)b.layer=B,b.draggable=B;b._method=e?e:b.method?d.fn[b.method]:b.type?
d.fn[ca[b.type]]:function(){};b.layer&&!b._layer&&(a=d(c),c=F(c),e=c.layers,g.name===f||ha(g.name)&&c.layer.names[g.name]===E)&&(g=new K(b),g.layer=B,g._layer=B,g._running={},g.data={},ma(a,c,g),na(a,c,g),za(a,c,g),Ba(a,c,g),b._event=g._event,g._method===d.fn.drawText&&a.measureText(g),g.index===f&&(g.index=e.length),e.splice(g.index,0,g),b._args=g,P(a,c,g,"add"));return g}function Ea(c,b){var a,e;for(e=0;e<da.length;e+=1)a=da[e],c["_"+a]=c[a],pa[a]=B,b&&delete c[a]}function La(c,b,a){for(var e in a)a.hasOwnProperty(e)&&
Z(a[e])&&(a[e]=a[e].call(c,b,e));return a}function Fa(c){var b,a,e=[],g=1;c.match(/^([a-z]+|#[0-9a-f]+)$/gi)&&("transparent"===c&&(c="rgba(0,0,0,0)"),a=ra.head,b=a.style.color,a.style.color=c,c=d.css(a,"color"),a.style.color=b);c.match(/^rgb/gi)&&(e=c.match(/\d+/gi),c.match(/%/gi)&&(g=2.55),e[0]*=g,e[1]*=g,e[2]*=g,e[3]=e[3]!==E?ta(e[3]):1);return e}function Ma(c){var b=3,a;"array"!==aa(c.start)&&(c.start=Fa(c.start),c.end=Fa(c.end));c.now=[];if(1!==c.start[3]||1!==c.end[3])b=4;for(a=0;a<b;a+=1)c.now[a]=
c.start[a]+(c.end[a]-c.start[a])*c.pos,3>a&&(c.now[a]=Na(c.now[a]));1!==c.start[3]||1!==c.end[3]?c.now="rgba("+c.now.join(",")+")":(c.now.slice(0,3),c.now="rgb("+c.now.join(",")+")");c.elem.nodeName?c.elem.style[c.prop]=c.now:c.elem[c.prop]=c.now}function Oa(c){N.events[c]=function(b,a){var e,g;g=a.event;e="mouseover"===c||"mouseout"===c?"mousemove":c;a.events[e]||(b.bind(e+".jCanvas",function(a){g.x=a.offsetX;g.y=a.offsetY;g.type=e;g.event=a;b.drawLayers({resetFire:B});a.preventDefault()}),a.events[e]=
B)}}function V(c,b,a){var e,g,h,d;if(a=a._args)c=F(c),e=c.event,e.x!==f&&e.y!==f&&(h=e.x*c.pixelRatio,d=e.y*c.pixelRatio,g=b.isPointInPath(h,d)||b.isPointInStroke&&b.isPointInStroke(h,d)),b=c.transforms,a.eventX=a.mouseX=e.x,a.eventY=a.mouseY=e.y,a.event=e.event,e=c.transforms.rotate,h=a.eventX,d=a.eventY,0!==e?(a._eventX=h*Q(-e)-d*U(-e),a._eventY=d*Q(-e)+h*U(-e)):(a._eventX=h,a._eventY=d),a._eventX/=b.scaleX,a._eventY/=b.scaleY,g&&c.intersecting.push(a),a.intersects=g}function Ga(c){for(;0>c;)c+=
2*L;return c}function Ha(c,b,a,e,g,h,d){var f,A,v;a.arrowRadius&&!a.closed&&(v=Pa(d-g,h-e),v-=L,f=a.strokeWidth*Q(v),A=a.strokeWidth*U(v),c=h+a.arrowRadius*Q(v+a.arrowAngle/2),e=d+a.arrowRadius*U(v+a.arrowAngle/2),g=h+a.arrowRadius*Q(v-a.arrowAngle/2),a=d+a.arrowRadius*U(v-a.arrowAngle/2),b.moveTo(c-f,e-A),b.lineTo(h-f,d-A),b.lineTo(g-f,a-A),b.moveTo(h-f,d-A),b.lineTo(h+f,d+A))}function ea(c,b,a,e,g,h,d,f,A,v,G){a.startArrow&&Ha(c,b,a,e,g,h,d);a.endArrow&&Ha(c,b,a,f,A,v,G)}function Ia(c,b){isNaN(Number(b.fontSize))||
(b.fontSize+="px");c.font=b.fontStyle+" "+b.fontSize+" "+b.fontFamily}function Ja(c,b,a,e){var g,h;g=Y.propCache;if(g.text===a.text&&g.fontStyle===a.fontStyle&&g.fontSize===a.fontSize&&g.fontFamily===a.fontFamily&&g.maxWidth===a.maxWidth&&g.lineHeight===a.lineHeight)a.width=g.width,a.height=g.height;else{a.width=b.measureText(e[0]).width;for(h=1;h<e.length;h+=1)g=b.measureText(e[h]).width,g>a.width&&(a.width=g);b=c.style.fontSize;c.style.fontSize=a.fontSize;a.height=ta(d.css(c,"fontSize"))*e.length*
a.lineHeight;c.style.fontSize=b}}function Ka(c,b){var a=b.maxWidth,e=b.text.split("\n"),g=[],h,d,f,A,v;for(f=0;f<e.length;f+=1){A=e[f];v=A.split(" ");h=[];d="";if(1===v.length||c.measureText(A).width<a)h=[A];else{for(A=0;A<v.length;A+=1)c.measureText(d+v[A]).width>a&&(""!==d&&h.push(d),d=""),d+=v[A],A!==v.length-1&&(d+=" ");h.push(d)}g=g.concat(h.join("\n").replace(/( (\n))|( $)/gi,"$2").split("\n"))}return g}var ga,W=d.extend,fa=d.inArray,aa=d.type,Z=d.isFunction,Na=$.round,L=$.PI,U=$.sin,Q=$.cos,
Pa=$.atan2,Qa=d.event.fix,la,qa,ca,Y={dataCache:{},propCache:{},imageCache:{}},ka={rotate:0,scaleX:1,scaleY:1,translateX:0,translateY:0,masks:[]},da,pa,Ca,Da;d.fn.jCanvas=N;N.events={};N.eventHooks={};ga={align:"center",arrowAngle:90,arrowRadius:0,autosave:B,baseline:"middle",bringToFront:z,ccw:z,closed:z,compositing:"source-over",concavity:0,cornerRadius:0,count:1,cropFromCenter:B,cursor:f,cursors:f,disableEvents:z,draggable:z,dragGroups:f,groups:f,data:f,dx:f,dy:f,each:f,end:360,eventX:f,eventY:f,
fillStyle:"transparent",fontStyle:"normal",fontSize:"12pt",fontFamily:"sans-serif",fromCenter:B,fn:f,height:f,imageSmoothing:B,inDegrees:B,index:f,lineHeight:1,layer:z,mask:z,maxWidth:f,miterLimit:10,name:f,opacity:1,r1:f,r2:f,radius:0,repeat:"repeat",respectAlign:z,rotate:0,rounded:z,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowStroke:z,shadowX:0,shadowY:0,sHeight:f,sides:0,source:"",spread:0,start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,
sWidth:f,sx:f,sy:f,text:"",translate:0,translateX:0,translateY:0,type:f,visible:B,width:f,x:0,y:0};N();N.extend=function(c){c.name&&(c.props&&(W(ga,c.props),N()),d.fn[c.name]=function a(e){var g,h,d,f;for(h=0;h<this.length;h+=1)if(g=this[h],d=J(g))f=new K(e),O(g,f,e,a),T(g,d,f),c.fn.call(g,d,f);return this},c.type&&(ca[c.type]=c.name));return d.fn[c.name]};d.fn.getEventHooks=function(){var c;c={};0!==this.length&&(c=this[0],c=F(c),c=c.eventHooks);return c};d.fn.setEventHooks=function(c){var b,a;for(b=
0;b<this.length;b+=1)d(this[b]),a=F(this[b]),W(a.eventHooks,c);return this};d.fn.getLayers=function(c){var b,a,e,g=[];if(0!==this.length)if(b=this[0],a=F(b),a=a.layers,Z(c))for(e=0;e<a.length;e+=1)c.call(b,a[e])&&g.push(a[e]);else g=a;return g};d.fn.getLayer=function(c){var b,a,e,g;if(0!==this.length)if(b=this[0],a=F(b),b=a.layers,g=aa(c),c&&c.layer)e=c;else if("number"===g)0>c&&(c=b.length+c),e=b[c];else if("regexp"===g)for(a=0;a<b.length;a+=1){if(ha(b[a].name)&&b[a].name.match(c)){e=b[a];break}}else e=
a.layer.names[c];return e};d.fn.getLayerGroup=function(c){var b,a,e,g=aa(c);if(0!==this.length)if(b=this[0],"array"===g)e=c;else if("regexp"===g)for(a in b=F(b),b=b.layer.groups,b){if(a.match(c)){e=b[a];break}}else b=F(b),e=b.layer.groups[c];return e};d.fn.getLayerIndex=function(c){var b=this.getLayers();c=this.getLayer(c);return fa(c,b)};d.fn.setLayer=function(c,b){var a,e,g,h;for(e=0;e<this.length;e+=1)if(a=d(this[e]),g=F(this[e]),h=d(this[e]).getLayer(c))ma(a,g,h,b),na(a,g,h,b),W(h,b),za(a,g,h),
Ba(a,g,h),d.isEmptyObject(b)===z&&P(a,g,h,"change",b);return this};d.fn.setLayers=function(c,b){var a,e,g,h;for(e=0;e<this.length;e+=1)for(a=d(this[e]),g=a.getLayers(b),h=0;h<g.length;h+=1)a.setLayer(g[h],c);return this};d.fn.setLayerGroup=function(c,b){var a,e,g,h;for(e=0;e<this.length;e+=1)if(a=d(this[e]),g=a.getLayerGroup(c))for(h=0;h<g.length;h+=1)a.setLayer(g[h],b);return this};d.fn.moveLayer=function(c,b){var a,e,g,h,f;for(e=0;e<this.length;e+=1)if(a=d(this[e]),g=F(this[e]),h=g.layers,f=a.getLayer(c))f.index=
fa(f,h),h.splice(f.index,1),h.splice(b,0,f),0>b&&(b=h.length+b),f.index=b,P(a,g,f,"move");return this};d.fn.removeLayer=function(c){var b,a,e,g,h;for(a=0;a<this.length;a+=1)if(b=d(this[a]),e=F(this[a]),g=b.getLayers(),h=b.getLayer(c))h.index=fa(h,g),g.splice(h.index,1),ma(b,e,h,{name:f}),na(b,e,h,{groups:f}),P(b,e,h,"remove");return this};d.fn.removeLayers=function(c){var b,a,e,g,h,f;for(a=0;a<this.length;a+=1){b=d(this[a]);e=F(this[a]);g=b.getLayers(c);for(f=0;f<g.length;f+=1)h=g[f],b.removeLayer(h),
f-=1;e.layer.names={};e.layer.groups={}}return this};d.fn.removeLayerGroup=function(c){var b,a,e,g;if(c!==E)for(a=0;a<this.length;a+=1)if(b=d(this[a]),F(this[a]),b.getLayers(),e=b.getLayerGroup(c))for(e=e.slice(0),g=0;g<e.length;g+=1)b.removeLayer(e[g]);return this};d.fn.addLayerToGroup=function(c,b){var a,e,g,h=[b];for(e=0;e<this.length;e+=1)a=d(this[e]),g=a.getLayer(c),g.groups&&(h=g.groups.slice(0),-1===fa(b,g.groups)&&h.push(b)),a.setLayer(g,{groups:h});return this};d.fn.removeLayerFromGroup=
function(c,b){var a,e,g,h=[],f;for(e=0;e<this.length;e+=1)a=d(this[e]),g=a.getLayer(c),g.groups&&(f=fa(b,g.groups),-1!==f&&(h=g.groups.slice(0),h.splice(f,1),a.setLayer(g,{groups:h})));return this};Ca=["grab","grabbing","zoom-in","zoom-out"];Da=function(){var c=getComputedStyle(ra.documentElement,""),c=(ja.prototype.slice.call(c).join("").match(/-(moz|webkit|ms)-/)||""===c.OLink&&["","o"])[1];return{lowercase:c,css:"-"+c+"-",js:c[0].toUpperCase()+c.substr(1)}}();d.fn.triggerLayerEvent=function(c,
b){var a,e,g;for(e=0;e<this.length;e+=1)a=d(this[e]),g=F(this[e]),(c=a.getLayer(c))&&P(a,g,c,b);return this};d.fn.drawLayer=function(c){var b,a,e;for(b=0;b<this.length;b+=1)a=d(this[b]),J(this[b]),(e=a.getLayer(c))&&e.visible&&e._method&&(e._next=f,e._method.call(a,e));return this};d.fn.drawLayers=function(c){var b,a,e=W({},c),g,h,M,I,A,v;e.index||(e.index=0);for(b=0;b<this.length;b+=1)if(c=d(this[b]),a=J(this[b])){I=F(this[b]);e.clear!==z&&c.clearCanvas();a=I.layers;for(M=e.index;M<a.length&&(g=
a[M],g.index=M,e.resetFire&&(g._fired=z),A=c,v=g,h=M+1,v&&v.visible&&v._method&&(v._next=h?h:f,v._method.call(A,v)),g._masks=I.transforms.masks.slice(0),g._method!==d.fn.drawImage||!g.visible);M+=1);g=I;var G=h=v=A=void 0;A=f;for(v=g.intersecting.length-1;0<=v;v-=1)if(A=g.intersecting[v],A._masks){for(G=A._masks.length-1;0<=G;G-=1)if(h=A._masks[G],!h.intersects){A.intersects=z;break}if(A.intersects)break}g=A;A=I.event;v=A.type;if(I.drag.layer){h=c;var G=I,H=v,x=void 0,n=void 0,r=void 0,y=r=void 0,
q=void 0,r=x=x=r=void 0,r=G.drag,y=(n=r.layer)&&n.dragGroups||[],x=G.layers;if("mousemove"===H||"touchmove"===H){if(r.dragging||(r.dragging=B,n.bringToFront&&(x.splice(n.index,1),n.index=x.push(n)),n._startX=n.x,n._startY=n.y,n._endX=n._eventX,n._endY=n._eventY,P(h,G,n,"dragstart")),r.dragging)for(x=n._eventX-(n._endX-n._startX),r=n._eventY-(n._endY-n._startY),n.dx=x-n.x,n.dy=r-n.y,n.x=x,n.y=r,P(h,G,n,"drag"),x=0;x<y.length;x+=1)if(r=y[x],q=G.layer.groups[r],n.groups&&q)for(r=0;r<q.length;r+=1)q[r]!==
n&&(q[r].x+=n.dx,q[r].y+=n.dy)}else if("mouseup"===H||"touchend"===H)r.dragging&&(P(h,G,n,"dragstop"),r.dragging=z),G.drag={}}h=I.lastIntersected;h===f||g===h||!h._hovered||h._fired||I.drag.dragging||(I.lastIntersected=f,h._fired=B,h._hovered=z,P(c,I,h,"mouseout"),c.css({cursor:I.cursor}));g&&(g[v]||qa[v]&&(v=qa[v]),g._event&&g.intersects&&(I.lastIntersected=g,!(g.mouseover||g.mouseout||g.cursors&&!I.drag.dragging)||g._hovered||g._fired||(g._fired=B,g._hovered=B,P(c,I,g,"mouseover")),g._fired||(g._fired=
B,A.type=f,P(c,I,g,v)),!g.draggable||g.disableEvents||"mousedown"!==v&&"touchstart"!==v||(I.drag.layer=g)));g!==f||I.drag.dragging||c.css({cursor:I.cursor});M===a.length&&(I.intersecting.length=0,I.transforms=ia(ka),I.savedTransforms.length=0)}return this};d.fn.addLayer=function(c){var b,a;for(b=0;b<this.length;b+=1)if(a=J(this[b]))a=new K(c),a.layer=B,O(this[b],a,c);return this};da=["width","height","opacity","lineHeight"];pa={};d.fn.animateLayer=function(){function c(a,b,c){return function(){var e,
g;for(g=0;g<da.length;g+=1)e=da[g],c[e]=c["_"+e];b.animating&&b.animated!==c||a.drawLayers();c._animating=z;b.animating=z;b.animated=f;h[4]&&h[4].call(a[0],c);P(a,b,c,"animateend")}}function b(a,b,c){return function(e,g){"_"===g.prop[0]&&(g=W({},g),g.prop=g.prop.replace("_",""),c[g.prop]=c["_"+g.prop]);c._pos!==g.pos&&(c._pos=g.pos,c._animating||b.animating||(c._animating=B,b.animating=B,b.animated=c),b.animating&&b.animated!==c||a.drawLayers());h[5]&&h[5].call(a[0],e,g,c);P(a,b,c,"animate",g)}}var a,
e,g,h=ja.prototype.slice.call(arguments,0),M,I;"object"===aa(h[2])?(h.splice(2,0,h[2].duration||f),h.splice(3,0,h[3].easing||f),h.splice(4,0,h[4].complete||f),h.splice(5,0,h[5].step||f)):(h[2]===E?(h.splice(2,0,f),h.splice(3,0,f),h.splice(4,0,f)):Z(h[2])&&(h.splice(2,0,f),h.splice(3,0,f)),h[3]===E?(h[3]=f,h.splice(4,0,f)):Z(h[3])&&h.splice(3,0,f));for(e=0;e<this.length;e+=1)if(a=d(this[e]),g=J(this[e]))g=F(this[e]),(M=a.getLayer(h[0]))&&M._method!==d.fn.draw&&(I=W({},h[1]),I=La(this[e],M,I),Ea(I,
B),Ea(M),M.style=pa,d(M).animate(I,{duration:h[2],easing:d.easing[h[3]]?h[3]:f,complete:c(a,g,M),step:b(a,g,M)}),P(a,g,M,"animatestart"));return this};d.fn.animateLayerGroup=function(c){var b,a,e=ja.prototype.slice.call(arguments,0),g,h;for(a=0;a<this.length;a+=1)if(b=d(this[a]),g=b.getLayerGroup(c))for(h=0;h<g.length;h+=1)e[0]=g[h],b.animateLayer.apply(b,e);return this};d.fn.delayLayer=function(c,b){var a,e,g,h;b=b||0;for(e=0;e<this.length;e+=1)if(a=d(this[e]),g=F(this[e]),h=a.getLayer(c))d(h).delay(b),
P(a,g,h,"delay");return this};d.fn.delayLayerGroup=function(c,b){var a,e,g,h,f;b=b||0;for(e=0;e<this.length;e+=1)if(a=d(this[e]),g=a.getLayerGroup(c))for(f=0;f<g.length;f+=1)h=g[f],a.delayLayer(h,b);return this};d.fn.stopLayer=function(c,b){var a,e,g,h;for(e=0;e<this.length;e+=1)if(a=d(this[e]),g=F(this[e]),h=a.getLayer(c))d(h).stop(b),P(a,g,h,"stop");return this};d.fn.stopLayerGroup=function(c,b){var a,e,g,h,f;for(e=0;e<this.length;e+=1)if(a=d(this[e]),g=a.getLayerGroup(c))for(f=0;f<g.length;f+=
1)h=g[f],a.stopLayer(h,b);return this};(function(c){var b;for(b=0;b<c.length;b+=1)d.fx.step[c[b]]=Ma})("color backgroundColor borderColor borderTopColor borderRightColor borderBottomColor borderLeftColor fillStyle outlineColor strokeStyle shadowColor".split(" "));la={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"};qa={touchstart:"mousedown",touchend:"mouseup",touchmove:"mousemove"};(function(c){var b;for(b=0;b<c.length;b+=1)Oa(c[b])})("click dblclick mousedown mouseup mousemove mouseover mouseout touchstart touchmove touchend".split(" "));
d.event.fix=function(c){var b,a;c=Qa.call(d.event,c);if(b=c.originalEvent)if(a=b.changedTouches,c.pageX!==E&&c.offsetX===E){if(b=d(c.currentTarget).offset())c.offsetX=c.pageX-b.left,c.offsetY=c.pageY-b.top}else a&&(b=d(c.currentTarget).offset())&&(c.offsetX=a[0].pageX-b.left,c.offsetY=a[0].pageY-b.top);return c};ca={arc:"drawArc",bezier:"drawBezier",ellipse:"drawEllipse","function":"draw",image:"drawImage",line:"drawLine",polygon:"drawPolygon",slice:"drawSlice",quadratic:"drawQuadratic",rectangle:"drawRect",
text:"drawText",vector:"drawVector"};d.fn.draw=function b(a){var e,g,h=new K(a);if(ca[h.type])this[ca[h.type]](a);else for(e=0;e<this.length;e+=1)if(d(this[e]),g=J(this[e]))h=new K(a),O(this[e],h,a,b),h.visible&&h.fn&&h.fn.call(this[e],g,h);return this};d.fn.clearCanvas=function a(e){var g,h,d=new K(e);for(g=0;g<this.length;g+=1)if(h=J(this[g]))d.width===f||d.height===f?(h.save(),h.setTransform(1,0,0,1,0,0),h.clearRect(0,0,this[g].width,this[g].height),h.restore()):(O(this[g],d,e,a),S(this[g],h,d,
d.width,d.height),h.clearRect(d.x-d.width/2,d.y-d.height/2,d.width,d.height),d._transformed&&h.restore());return this};d.fn.saveCanvas=function e(g){var h,d,f,A,v;for(h=0;h<this.length;h+=1)if(d=J(this[h]))for(A=F(this[h]),f=new K(g),O(this[h],f,g,e),v=0;v<f.count;v+=1)ba(d,A);return this};d.fn.restoreCanvas=function g(h){var d,f,A,v,G;for(d=0;d<this.length;d+=1)if(f=J(this[d]))for(v=F(this[d]),A=new K(h),O(this[d],A,h,g),G=0;G<A.count;G+=1){var H=f,x=v;0===x.savedTransforms.length?x.transforms=ia(ka):
(H.restore(),x.transforms=x.savedTransforms.pop())}return this};d.fn.rotateCanvas=function h(d){var f,A,v,G;for(f=0;f<this.length;f+=1)if(A=J(this[f]))G=F(this[f]),v=new K(d),O(this[f],v,d,h),v.autosave&&ba(A,G),wa(A,v,G.transforms);return this};d.fn.scaleCanvas=function M(d){var f,v,G,H;for(f=0;f<this.length;f+=1)if(v=J(this[f]))H=F(this[f]),G=new K(d),O(this[f],G,d,M),G.autosave&&ba(v,H),xa(v,G,H.transforms);return this};d.fn.translateCanvas=function I(d){var f,G,H,x;for(f=0;f<this.length;f+=1)if(G=
J(this[f]))x=F(this[f]),H=new K(d),O(this[f],H,d,I),H.autosave&&ba(G,x),ya(G,H,x.transforms);return this};d.fn.drawRect=function A(d){var f,H,x,n,r,y,q,t;for(f=0;f<this.length;f+=1)if(H=J(this[f]))x=new K(d),O(this[f],x,d,A),x.visible&&(T(this[f],H,x),S(this[f],H,x,x.width,x.height),H.beginPath(),n=x.x-x.width/2,r=x.y-x.height/2,(t=x.cornerRadius)?(y=x.x+x.width/2,q=x.y+x.height/2,0>y-n-2*t&&(t=(y-n)/2),0>q-r-2*t&&(t=(q-r)/2),H.moveTo(n+t,r),H.lineTo(y-t,r),H.arc(y-t,r+t,t,3*L/2,2*L,z),H.lineTo(y,
q-t),H.arc(y-t,q-t,t,0,L/2,z),H.lineTo(n+t,q),H.arc(n+t,q-t,t,L/2,L,z),H.lineTo(n,r+t),H.arc(n+t,r+t,t,L,3*L/2,z),x.closed=B):H.rect(n,r,x.width,x.height),V(this[f],H,x),X(this[f],H,x));return this};d.fn.drawArc=function v(d){var f,x,n,r,y,q,t,p,l,k,m;for(f=0;f<this.length;f+=1)if(x=J(this[f]))n=new K(d),O(this[f],n,d,v),n.visible&&(T(this[f],x,n),S(this[f],x,n,2*n.radius),n.inDegrees||360!==n.end||(n.end=2*L),n.start*=n._toRad,n.end*=n._toRad,n.start-=L/2,n.end-=L/2,x.beginPath(),x.arc(n.x,n.y,n.radius,
n.start,n.end,n.ccw),l=L/180*1,n.ccw&&(l*=-1),r=n.x+n.radius*Q(n.start+l),y=n.y+n.radius*U(n.start+l),q=n.x+n.radius*Q(n.start),t=n.y+n.radius*U(n.start),p=n.x+n.radius*Q(n.end+l),l=n.y+n.radius*U(n.end+l),k=n.x+n.radius*Q(n.end),m=n.y+n.radius*U(n.end),ea(this[f],x,n,r,y,q,t,k,m,p,l),V(this[f],x,n),X(this[f],x,n));return this};d.fn.drawEllipse=function G(f){var d,n,r,y,q;for(d=0;d<this.length;d+=1)if(n=J(this[d]))r=new K(f),O(this[d],r,f,G),r.visible&&(T(this[d],n,r),S(this[d],n,r,r.width,r.height),
y=4/3*r.width,q=r.height,n.beginPath(),n.moveTo(r.x,r.y-q/2),n.bezierCurveTo(r.x-y/2,r.y-q/2,r.x-y/2,r.y+q/2,r.x,r.y+q/2),n.bezierCurveTo(r.x+y/2,r.y+q/2,r.x+y/2,r.y-q/2,r.x,r.y-q/2),V(this[d],n,r),r.closed=B,X(this[d],n,r));return this};d.fn.drawPolygon=function H(d){var f,r,y,q,t,p,l,k,m,u;for(f=0;f<this.length;f+=1)if(r=J(this[f]))if(y=new K(d),O(this[f],y,d,H),y.visible){T(this[f],r,y);S(this[f],r,y,2*y.radius);t=2*L/y.sides;p=t/2;q=p+L/2;l=y.radius*Q(p);r.beginPath();for(u=0;u<y.sides;u+=1)k=
y.x+y.radius*Q(q),m=y.y+y.radius*U(q),r.lineTo(k,m),y.concavity&&(k=y.x+(l+-l*y.concavity)*Q(q+p),m=y.y+(l+-l*y.concavity)*U(q+p),r.lineTo(k,m)),q+=t;V(this[f],r,y);y.closed=B;X(this[f],r,y)}return this};d.fn.drawSlice=function x(f){var r,y,q,t,p;for(r=0;r<this.length;r+=1)if(d(this[r]),y=J(this[r]))q=new K(f),O(this[r],q,f,x),q.visible&&(T(this[r],y,q),S(this[r],y,q,2*q.radius),q.start*=q._toRad,q.end*=q._toRad,q.start-=L/2,q.end-=L/2,q.start=Ga(q.start),q.end=Ga(q.end),q.end<q.start&&(q.end+=2*
L),t=(q.start+q.end)/2,p=q.radius*q.spread*Q(t),t=q.radius*q.spread*U(t),q.x+=p,q.y+=t,y.beginPath(),y.arc(q.x,q.y,q.radius,q.start,q.end,q.ccw),y.lineTo(q.x,q.y),V(this[r],y,q),q.closed=B,X(this[r],y,q));return this};d.fn.drawLine=function n(f){var d,q,t,p,l,k;for(d=0;d<this.length;d+=1)if(q=J(this[d]))if(t=new K(f),O(this[d],t,f,n),t.visible){T(this[d],q,t);S(this[d],q,t);p=1;for(q.beginPath();B;)if(l=t["x"+p],k=t["y"+p],l!==E&&k!==E)q.lineTo(l+t.x,k+t.y),p+=1;else break;p-=1;ea(this[d],q,t,t.x2+
t.x,t.y2+t.y,t.x1+t.x,t.y1+t.y,t["x"+(p-1)]+t.x,t["y"+(p-1)]+t.y,t["x"+p]+t.x,t["y"+p]+t.y);V(this[d],q,t);X(this[d],q,t)}return this};d.fn.drawQuadratic=function r(d){var f,t,p,l,k,m,u,w;for(f=0;f<this.length;f+=1)if(t=J(this[f]))if(p=new K(d),O(this[f],p,d,r),p.visible){T(this[f],t,p);S(this[f],t,p);l=2;t.beginPath();for(t.moveTo(p.x1+p.x,p.y1+p.y);B;)if(k=p["x"+l],m=p["y"+l],u=p["cx"+(l-1)],w=p["cy"+(l-1)],k!==E&&m!==E&&u!==E&&w!==E)t.quadraticCurveTo(u+p.x,w+p.y,k+p.x,m+p.y),l+=1;else break;l-=
1;ea(this[f],t,p,p.cx1+p.x,p.cy1+p.y,p.x1+p.x,p.y1+p.y,p["cx"+(l-1)]+p.x,p["cy"+(l-1)]+p.y,p["x"+l]+p.x,p["y"+l]+p.y);V(this[f],t,p);X(this[f],t,p)}return this};d.fn.drawBezier=function y(f){var d,p,l,k,m,u,w,s,D,z,C;for(d=0;d<this.length;d+=1)if(p=J(this[d]))if(l=new K(f),O(this[d],l,f,y),l.visible){T(this[d],p,l);S(this[d],p,l);k=2;m=1;p.beginPath();for(p.moveTo(l.x1+l.x,l.y1+l.y);B;)if(u=l["x"+k],w=l["y"+k],s=l["cx"+m],D=l["cy"+m],z=l["cx"+(m+1)],C=l["cy"+(m+1)],u!==E&&w!==E&&s!==E&&D!==E&&z!==
E&&C!==E)p.bezierCurveTo(s+l.x,D+l.y,z+l.x,C+l.y,u+l.x,w+l.y),k+=1,m+=2;else break;k-=1;m-=2;ea(this[d],p,l,l.cx1+l.x,l.cy1+l.y,l.x1+l.x,l.y1+l.y,l["cx"+(m+1)]+l.x,l["cy"+(m+1)]+l.y,l["x"+k]+l.x,l["y"+k]+l.y);V(this[d],p,l);X(this[d],p,l)}return this};d.fn.drawVector=function q(d){var f,l,k,m,u,w,s,D,z,C,F,R;for(f=0;f<this.length;f+=1)if(l=J(this[f]))if(k=new K(d),O(this[f],k,d,q),k.visible){T(this[f],l,k);S(this[f],l,k);m=1;l.beginPath();z=F=s=k.x;C=R=D=k.y;for(l.moveTo(k.x,k.y);B;)if(u=k["a"+m],
w=k["l"+m],u!==E&&w!==E)u*=k._toRad,u-=L/2,z=F,C=R,F+=w*Q(u),R+=w*U(u),1===m&&(s=F,D=R),l.lineTo(F,R),m+=1;else break;ea(this[f],l,k,s,D,k.x,k.y,z,C,F,R);V(this[f],l,k);X(this[f],l,k)}return this};d.fn.drawText=function t(p){var l,k,m,u,w,s,D;for(l=0;l<this.length;l+=1)if(d(this[l]),k=J(this[l]))if(m=new K(p),u=O(this[l],m,p,t),m.visible){T(this[l],k,m);k.textBaseline=m.baseline;k.textAlign=m.align;Ia(k,m);w=m.maxWidth!==f?Ka(k,m):m.text.toString().split("\n");Ja(this[l],k,m,w);u&&(u.width=m.width,
u.height=m.height);S(this[l],k,m,m.width,m.height);s=m.x;"left"===m.align?m.respectAlign?m.x+=m.width/2:s-=m.width/2:"right"===m.align&&(m.respectAlign?m.x-=m.width/2:s+=m.width/2);for(u=0;u<w.length;u+=1)k.shadowColor=m.shadowColor,D=m.y+u*m.height/w.length-(w.length-1)*m.height/w.length/2,k.fillText(w[u],s,D),"transparent"!==m.fillStyle&&(k.shadowColor="transparent"),k.strokeText(w[u],s,D);m._event&&(k.beginPath(),k.rect(m.x-m.width/2,m.y-m.height/2,m.width,m.height),V(this[l],k,m),k.closePath());
m._transformed&&k.restore()}Y.propCache=m;return this};d.fn.measureText=function(f){var d,l;d=this.getLayer(f);if(!d||d&&!d._layer)d=new K(f);if(f=J(this[0]))Ia(f,d),l=Ka(f,d),Ja(this[0],f,d,l);return d};d.fn.drawImage=function p(l){function k(l,p,m,k,s){return function(){var u=d(l);T(l,p,k);k.width===f&&k.sWidth===f&&(k.width=k.sWidth=C.width);k.height===f&&k.sHeight===f&&(k.height=k.sHeight=C.height);s&&(s.width=k.width,s.height=k.height);k.sWidth!==f&&k.sHeight!==f&&k.sx!==f&&k.sy!==f?(k.width===
f&&(k.width=k.sWidth),k.height===f&&(k.height=k.sHeight),k.cropFromCenter||(k.sx+=k.sWidth/2,k.sy+=k.sHeight/2),0>k.sy-k.sHeight/2&&(k.sy=k.sHeight/2),k.sy+k.sHeight/2>C.height&&(k.sy=C.height-k.sHeight/2),0>k.sx-k.sWidth/2&&(k.sx=k.sWidth/2),k.sx+k.sWidth/2>C.width&&(k.sx=C.width-k.sWidth/2),S(l,p,k,k.width,k.height),p.drawImage(C,k.sx-k.sWidth/2,k.sy-k.sHeight/2,k.sWidth,k.sHeight,k.x-k.width/2,k.y-k.height/2,k.width,k.height)):(S(l,p,k,k.width,k.height),p.drawImage(C,k.x-k.width/2,k.y-k.height/
2,k.width,k.height));p.beginPath();p.rect(k.x-k.width/2,k.y-k.height/2,k.width,k.height);V(l,p,k);p.closePath();k._transformed&&p.restore();va(p,m,k);P(u,m,s,"load");k.layer&&(s._masks=m.transforms.masks.slice(0),k._next&&u.drawLayers({clear:z,resetFire:B,index:k._next}))}}var m,u,w,s,D,L,C,N,R,Q=Y.imageCache;for(u=0;u<this.length;u+=1)if(m=this[u],w=J(this[u]))s=F(this[u]),D=new K(l),L=O(this[u],D,l,p),D.visible&&(R=D.source,N=R.getContext,R.src||N?C=R:R&&(Q[R]!==E?C=Q[R]:(C=new sa,C.src=R,Q[R]=
C)),C&&(C.complete||N?k(m,w,s,D,L)():(d(C).bind("load",k(m,w,s,D,L)),C.src=C.src)));return this};d.fn.createPattern=function(p){function l(){s=m.createPattern(w,u.repeat);u.load&&u.load.call(k[0],s)}var k=this,m,u,w,s,D;(m=J(k[0]))?(u=new K(p),D=u.source,Z(D)?(w=d("<canvas />")[0],w.width=u.width,w.height=u.height,p=J(w),D.call(w,p),l()):(p=D.getContext,D.src||p?w=D:(w=new sa,w.src=D),w.complete||p?l():(d(w).bind("load",l),w.src=w.src))):s=f;return s};d.fn.createGradient=function(d){var l,k=[],m,
u,w,s,D,B,C;d=new K(d);if(l=J(this[0])){d.x1=d.x1||0;d.y1=d.y1||0;d.x2=d.x2||0;d.y2=d.y2||0;l=d.r1!==f&&d.r2!==f?l.createRadialGradient(d.x1,d.y1,d.r1,d.x2,d.y2,d.r2):l.createLinearGradient(d.x1,d.y1,d.x2,d.y2);for(s=1;d["c"+s]!==E;s+=1)d["s"+s]!==E?k.push(d["s"+s]):k.push(f);m=k.length;k[0]===f&&(k[0]=0);k[m-1]===f&&(k[m-1]=1);for(s=0;s<m;s+=1){if(k[s]!==f){B=1;C=0;u=k[s];for(D=s+1;D<m;D+=1)if(k[D]!==f){w=k[D];break}else B+=1;u>w&&(k[D]=k[s])}else k[s]===f&&(C+=1,k[s]=u+(w-u)/B*C);l.addColorStop(k[s],
d["c"+(s+1)])}}else l=f;return l};d.fn.setPixels=function l(d){var m,u,w,s,D,B,C,z,F;for(u=0;u<this.length;u+=1)if(m=this[u],w=J(m)){s=new K(d);O(m,s,d,l);S(this[u],w,s,s.width,s.height);if(s.width===f||s.height===f)s.width=m.width,s.height=m.height,s.x=s.width/2,s.y=s.height/2;if(0!==s.width&&0!==s.height){B=w.getImageData(s.x-s.width/2,s.y-s.height/2,s.width,s.height);C=B.data;F=C.length;if(s.each)for(z=0;z<F;z+=4)D={r:C[z],g:C[z+1],b:C[z+2],a:C[z+3]},s.each.call(m,D,s),C[z]=D.r,C[z+1]=D.g,C[z+
2]=D.b,C[z+3]=D.a;w.putImageData(B,s.x-s.width/2,s.y-s.height/2);w.restore()}}return this};d.fn.getCanvasImage=function(d,k){var m,u=f;0!==this.length&&(m=this[0],m.toDataURL&&(k===E&&(k=1),u=m.toDataURL("image/"+d,k)));return u};d.fn.detectPixelRatio=function(f){var k,m,u,w,s,z,E;for(m=0;m<this.length;m+=1)k=this[m],d(this[m]),u=J(k),E=F(this[m]),E.scaled||(w=window.devicePixelRatio||1,s=u.webkitBackingStorePixelRatio||u.mozBackingStorePixelRatio||u.msBackingStorePixelRatio||u.oBackingStorePixelRatio||
u.backingStorePixelRatio||1,w/=s,1!==w&&(s=k.width,z=k.height,k.width=s*w,k.height=z*w,k.style.width=s+"px",k.style.height=z+"px",u.scale(w,w)),E.pixelRatio=w,E.scaled=B,f&&f.call(k,w));return this};N.clearCache=function(){for(var d in Y)Y.hasOwnProperty(d)&&(Y[d]={})};d.support.canvas=d("<canvas />")[0].getContext!==E;N.defaults=ga;N.setGlobalProps=T;N.transformShape=S;N.detectEvents=V;N.closePath=X;d.jCanvas=N})(jQuery,document,Image,Array,Math,parseFloat,!0,!1,null);

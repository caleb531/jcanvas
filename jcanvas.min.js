/*!
jCanvas v5.3b
Copyright 2012, Caleb Evans
Licensed under the MIT license
*/
(function(z,H,c,u,M,t,o,w,Q,x,A){var B,S,G=z.extend,O=u.round,d=u.PI,p=u.sin,b=u.cos,k=z.event.fix,s={},n={},J="transparent",D,E;function F(){}function P(T){if(T){G(S,T)}else{S=F.prototype=G({},B)}return this}z.fn.jCanvas=P;P.version="5.3b";P.events={};B={angle:0,align:"center",autosave:w,baseline:"middle",ccw:Q,closed:Q,compositing:"source-over",cornerRadius:0,cropFromCenter:w,each:x,end:360,fillStyle:J,font:"12pt sans-serif",fromCenter:w,height:x,inDegrees:w,load:x,mask:Q,miterLimit:10,opacity:1,projection:0,r1:x,r2:x,radius:0,repeat:"repeat",rounded:Q,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:J,shadowX:0,shadowY:0,sHeight:0,sides:3,source:"",start:0,strokeCap:"butt",strokeJoin:"miter",strokeStyle:J,strokeWidth:1,sWidth:0,sx:x,sy:x,text:"",visible:w,width:x,x:0,x1:0,x2:0,y:0,y1:0,y2:0};P();function K(T,U){T.fillStyle=U.fillStyle;T.strokeStyle=U.strokeStyle;T.lineWidth=U.strokeWidth;if(U.rounded){T.lineCap="round";T.lineJoin="round"}else{T.lineCap=U.strokeCap;T.lineJoin=U.strokeJoin;T.miterLimit=U.miterLimit}T.shadowOffsetX=U.shadowX;T.shadowOffsetY=U.shadowY;T.shadowBlur=U.shadowBlur;T.shadowColor=U.shadowColor;T.globalAlpha=U.opacity;T.globalCompositeOperation=U.compositing}s.x=[];s.y=[];function C(T){P.events[T]=function U(V){V.bind(T+".jCanvas",function(W){s.x[0]=W.offsetX;s.y[0]=W.offsetY;s.type=W.type;V.drawLayers()});U.called=w}}C("click");C("dblclick");C("mousedown");C("mouseup");C("mousemove");P.events.mouseover=P.events.mouseout=function y(T){T.bind("mousemove.jCanvas",function(U){s.x[1]=s.x[0];s.y[1]=s.y[0];s.x[0]=U.offsetX;s.y[0]=U.offsetY;s.type="hover";T.drawLayers()});y.called=w};function e(T){T.mouseX=s.x[0];T.mouseY=s.y[0];s.x=[];s.y=[]}function N(X,T,V){var W=s.type,Z=V[W],Y=T.isPointInPath(s.x[0],s.y[0]),U=T.isPointInPath(s.x[1],s.y[1]);if(W==="hover"){if(Y&&!U&&!V.fired){V.fired=w;e(V);if(V.mouseover){V.mouseover.call(X,V);K(T,V)}}else{if(!Y&&U&&V.fired){V.fired=Q;e(V);if(V.mouseout){V.mouseout.call(X,V);K(T,V)}}}}else{if(W!=="hover"&&Z&&Y){e(V);Z.call(X,V);K(T,V)}}}function i(T){return(T&&T.getContext?T.getContext("2d"):x)}function q(T,U){if(U.mask){if(U.autosave){T.save()}T.clip()}if(U.closed){T.closePath();T.fill();T.stroke()}else{T.fill();T.stroke();T.closePath()}}function v(T,U){if(U.scale!==1){U.scaleX=U.scaleY=U.scale}if(U.scaleX!==1||U.scaleY!==1){T.translate(U.x,U.y);T.scale(U.scaleX,U.scaleY);T.translate(-U.x,-U.y)}}function r(T,U){U.toRad=(U.inDegrees?d/180:1);T.translate(U.x,U.y);T.rotate(U.angle*U.toRad);T.translate(-U.x,-U.y)}function g(U,W,V,T){W.toRad=(W.inDegrees?d/180:1);U.save();if(!W.fromCenter){W.x+=V/2;W.y+=T/2}if(W.angle){r(U,W)}v(U,W)}function m(T){T=T||{};B=G(B,T.props);P();if(T.name){z.fn[T.name]=function(V){var Z=this,W,X,U,Y=G(new F(),V);for(X=0;X<Z.length;X+=1){W=Z[X];U=i(W);if(U){K(U,Y);T.fn.call(W,U,Y)}}return Z}}return z.fn[T.name]}z.fn.loadCanvas=function(){return i(this[0])};z.fn.getCanvasImage=function(T,V){var U=this[0];if(!T){T="png"}T=T.replace(/^(\w+)$/gi,"image/$1").replace(/jpg/gi,"jpeg");return(U&&U.toDataURL)?U.toDataURL(T,V):x};z.fn.draw=function(W){var V=this,U,T;for(U=0;U<V.length;U+=1){T=i(V[U]);if(T){W.call(V[U],T)}}return V};z.fn.gradient=function(ab){var T=this,af,Y=G(new F(),ab),ad,ae=[],aa,V,X,Z,ac,W,U;ab=ab||{};af=i(T[0]);if(af){if(!Y.c2){ad=Y.c1}else{if(Y.r1!==x||Y.r2!==x){ad=af.createRadialGradient(Y.x1,Y.y1,Y.r1,Y.x2,Y.y2,Y.r2)}else{ad=af.createLinearGradient(Y.x1,Y.y1,Y.x2,Y.y2)}for(Z=1;Y["c"+Z]!==A;Z+=1){if(Y["s"+Z]!==A){ae.push(Y["s"+Z])}else{ae.push(x)}}aa=ae.length;if(ae[0]===x){ae[0]=0}if(ae[aa-1]===x){ae[aa-1]=1}for(Z=0;Z<aa;Z+=1){if(ae[Z]!==x&&ae[Z]!==1){W=1;U=0;V=ae[Z];for(ac=(Z+1);ac<aa;ac+=1){if(ae[ac]!==x){X=ae[ac];break}else{W+=1}}if(V>X){ae[ac]=ae[Z]}}else{if(ae[Z]===x){U+=1;ae[Z]=V+(U*((X-V)/W));ab["s"+(Z+1)]=ae[Z]}}ad.addColorStop(ae[Z],Y["c"+(Z+1)])}}}else{ad=x}return ad};z.fn.pattern=function(Z){var T=this,ab,V=G(new F(),Z),W,Y,aa;function X(){Y=ab.createPattern(W,V.repeat)}function U(){X();if(V.load){V.load.call(T[0],Y)}}ab=i(T[0]);if(ab){W=new M();if(typeof V.source==="function"){W=c.createElement("canvas");W.width=V.width;W.height=V.height;aa=i(W);V.source.call(W,aa);U()}else{if(V.source.src){W=V.source}else{W.src=V.source}if(W.complete){U()}else{W.onload=U}}}else{Y=x}return Y};z.fn.clearCanvas=function(U){var X=this,V,T,W=G(new F(),U);for(V=0;V<X.length;V+=1){T=i(X[V]);if(T){if(!V){g(T,W,W.width,W.height)}if(!W.width&&!W.height){T.clearRect(0,0,X[V].width,X[V].height)}else{T.clearRect(W.x-W.width/2,W.y-W.height/2,W.width,W.height)}}}return X};z.fn.saveCanvas=function(){var V=this,U,T;for(U=0;U<V.length;U+=1){T=i(V[U]);if(T){T.save()}}return V};z.fn.restoreCanvas=function(){var V=this,U,T;for(U=0;U<V.length;U+=1){T=i(V[U]);if(T){T.restore()}}return V};z.fn.scaleCanvas=function(U){var X=this,V,T,W=G(new F(),U);for(V=0;V<X.length;V+=1){T=i(X[V]);if(T){if(W.autosave){T.save()}v(T,W)}}return X};z.fn.translateCanvas=function(U){var X=this,V,T,W=G(new F(),U);for(V=0;V<X.length;V+=1){T=i(X[V]);if(T){if(W.autosave){T.save()}T.translate(W.x,W.y)}}return X};z.fn.rotateCanvas=function(U){var X=this,V,T,W=G(new F(),U);for(V=0;V<X.length;V+=1){T=i(X[V]);if(T){if(W.autosave){T.save()}r(T,W)}}return X};z.fn.drawRect=function(Z){var U=this,Y,ac,X=G(new F(),Z),W,ab,V,aa,T;for(Y=0;Y<U.length;Y+=1){ac=i(U[Y]);if(ac){K(ac,X);if(!Y){g(ac,X,X.width,X.height)}ac.beginPath();if(X.cornerRadius){X.closed=w;W=X.x-X.width/2;ab=X.y-X.height/2;V=X.x+X.width/2;aa=X.y+X.height/2;T=X.cornerRadius;if((V-W)-(2*T)<0){T=(V-W)/2}if((aa-ab)-(2*T)<0){T=(aa-ab)/2}ac.moveTo(W+T,ab);ac.lineTo(V-T,ab);ac.arc(V-T,ab+T,T,3*d/2,d*2,Q);ac.lineTo(V,aa-T);ac.arc(V-T,aa-T,T,0,d/2,Q);ac.lineTo(W+T,aa);ac.arc(W+T,aa-T,T,d/2,d,Q);ac.lineTo(W,ab+T);ac.arc(W+T,ab+T,T,d,3*d/2,Q)}else{ac.rect(X.x-X.width/2,X.y-X.height/2,X.width,X.height)}ac.restore();if(X.event){N(U[Y],ac,Z)}q(ac,X)}}return U};z.fn.drawArc=function(U){var X=this,V,T,W=G(new F(),U);if(!W.inDegrees&&W.end===360){W.end=d*2}for(V=0;V<X.length;V+=1){T=i(X[V]);if(T){K(T,W);g(T,W,W.radius*2,W.radius*2);T.beginPath();T.arc(W.x,W.y,W.radius,(W.start*W.toRad)-(d/2),(W.end*W.toRad)-(d/2),W.ccw);T.restore();if(W.event){N(X[V],T,U)}q(T,W)}}return X};z.fn.drawEllipse=function(U){var Y=this,W,T,X=G(new F(),U),V=X.width*4/3;for(W=0;W<Y.length;W+=1){T=i(Y[W]);if(T){K(T,X);if(!W){g(T,X,X.width,X.height)}T.beginPath();T.moveTo(X.x,X.y-X.height/2);T.bezierCurveTo(X.x-V/2,X.y-X.height/2,X.x-V/2,X.y+X.height/2,X.x,X.y+X.height/2);T.bezierCurveTo(X.x+V/2,X.y+X.height/2,X.x+V/2,X.y-X.height/2,X.x,X.y-X.height/2);T.restore();if(X.event){N(Y[W],T,U)}q(T,X)}}return Y};z.fn.drawLine=function(V){var aa=this,Y,U,Z=G(new F(),V),T=2,X=0,W=0;for(Y=0;Y<aa.length;Y+=1){U=i(aa[Y]);if(U){K(U,Z);U.beginPath();U.moveTo(Z.x1,Z.y1);while(w){X=Z["x"+T];W=Z["y"+T];if(X!==A&&W!==A){U.lineTo(X,W);T+=1}else{break}}if(Z.event){N(aa[Y],U,V)}q(U,Z)}}return aa};z.fn.drawQuad=function(Z){var T=this,Y,ac,X=G(new F(),Z),W=2,V=0,U=0,ab=0,aa=0;for(Y=0;Y<T.length;Y+=1){ac=i(T[Y]);if(ac){K(ac,X);ac.beginPath();ac.moveTo(X.x1,X.y1);while(w){V=X["x"+W];U=X["y"+W];ab=X["cx"+(W-1)];aa=X["cy"+(W-1)];if(V!==A&&U!==A&&ab!==A&&aa!==A){ac.quadraticCurveTo(ab,aa,V,U);W+=1}else{break}}if(X.event){N(T[Y],ac,Z)}q(ac,X)}}return T};z.fn.drawBezier=function(ae){var T=this,ad,af,aa=G(new F(),ae),Z=2,W=1,Y=0,X=0,ac=0,V=0,ab=0,U=0;for(ad=0;ad<T.length;ad+=1){af=i(T[ad]);if(af){K(af,aa);af.beginPath();af.moveTo(aa.x1,aa.y1);while(w){Y=aa["x"+Z];X=aa["y"+Z];ac=aa["cx"+W];V=aa["cy"+W];ab=aa["cx"+(W+1)];U=aa["cy"+(W+1)];if(Y!==A&&X!==A&&ac!==A&&V!==A&&ab!==A&&U!==A){af.bezierCurveTo(ac,V,ab,U,Y,X);Z+=1;W+=2}else{break}}if(aa.event){N(T[ad],af,ae)}q(af,aa)}}return T};function I(W,T,X){var U,V;X.width=T.measureText(X.text).width;if(n.font===X.font&&n.text===X.text){X.height=n.height}else{U=W.style.fontSize;V=X.font.match(/\d+/gi);if(V){W.style.fontSize=(X.font.match(/(\d*\.?\d*)\w+/gi)||z.css(W,"fontSize"))[0]}X.height=t(z.css(W,"fontSize"));W.style.fontSize=U}}z.fn.drawText=function(V){var Y=this,U,W,T,X=G(new F(),V);for(W=0;W<Y.length;W+=1){U=z(Y[W]);T=i(U[0]);if(T){K(T,X);T.textBaseline=X.baseline;T.textAlign=X.align;T.font=X.font;I(U[0],T,X);if(!W){g(T,X,X.width,X.height)}T.strokeText(X.text,X.x,X.y);T.fillText(X.text,X.x,X.y);if(X.event){T.beginPath();T.rect(X.x-X.width/2,X.y-X.height/2,X.width,X.height);T.restore();N(Y[W],T,V);T.closePath()}else{T.restore()}}}n=X;return Y};z.fn.drawImage=function(aa){var T=this,V,Z,ac,X=G(new F(),aa),Y,U;aa=aa||{};if(X.source.src){Y=X.source}else{if(X.source){Y=new M();Y.src=X.source}}function ab(ad,ae){if(!ae){U=Y.width/Y.height;X.sWidth=X.sWidth||Y.width;X.sHeight=X.sHeight||Y.height;if(X.sWidth>Y.width){X.sWidth=Y.width}if(X.sHeight>Y.height){X.sHeight=Y.height}if(X.width===x&&X.sWidth!==Y.width){X.width=X.sWidth}if(X.height===x&&X.sHeight!==Y.height){X.height=X.sHeight}if(X.sx===x){if(X.cropFromCenter){X.sx=Y.width/2}else{X.sx=0}}if(X.sy===x){if(X.cropFromCenter){X.sy=Y.height/2}else{X.sy=0}}if(!X.cropFromCenter){X.sx+=X.sWidth/2;X.sy+=X.sHeight/2}if((X.sx+X.sWidth/2)>Y.width){X.sx=Y.width-X.sWidth/2}if((X.sx-X.sWidth/2)<0){X.sx=X.sWidth/2}if((X.sy-X.sHeight/2)<0){X.sy=X.sHeight/2}if((X.sy+X.sHeight/2)>Y.height){X.sy=Y.height-X.sHeight/2}if(X.width!==x&&X.height===x){aa.height=X.height=X.width/U}else{if(X.width===x&&X.height!==x){aa.width=X.width=X.height*U}else{if(X.width===x&&X.height===x){aa.width=X.width=Y.width;aa.height=X.height=Y.height}}}if(!ae){g(ad,X,X.width,X.height)}}ad.drawImage(Y,X.sx-X.sWidth/2,X.sy-X.sHeight/2,X.sWidth,X.sHeight,X.x-X.width/2,X.y-X.height/2,X.width,X.height);if(X.event){ad.fillStyle="#000";ad.beginPath();ad.rect(X.x-X.width/2,X.y-X.height/2,X.width,X.height);ad.restore();N(T[ae],ad,aa);ad.closePath()}else{ad.restore()}}function W(ae,af,ad){return function(){ab(ad,af);if(X.load){X.load.call(ae)}}}for(Z=0;Z<T.length;Z+=1){V=T[Z];ac=i(T[Z]);if(ac){K(ac,X);if(Y){if(Y.complete){W(V,Z,ac)()}else{Y.onload=W(V,Z,ac)}}}}return T};z.fn.drawPolygon=function(aa){var T=this,Z,af,X=G(new F(),aa),ag=d/X.sides,W=(d/2)+ag,ae=(d*2)/X.sides,ad=b(ae/2)*X.radius,V,ac,U,ab,Y;X.closed=w;if(X.sides>2){for(Z=0;Z<T.length;Z+=1){af=i(T[Z]);if(af){K(af,X);if(!Z){g(af,X,X.radius,X.radius)}af.beginPath();for(Y=0;Y<X.sides;Y+=1){V=X.x+O(X.radius*b(W));ac=X.y+O(X.radius*p(W));if(!Y){af.moveTo(V,ac)}else{af.lineTo(V,ac)}if(X.projection){U=X.x+O((ad+ad*X.projection)*b(W+ag));ab=X.y+O((ad+ad*X.projection)*p(W+ag));af.lineTo(U,ab)}W+=ae}af.restore();if(X.event){N(T[Z],af,aa)}q(af,X)}}}return T};z.fn.setPixels=function(ab){var T=this,V,aa,ad,W=G(new F(),ab),U,Y,X,Z,ac={};for(aa=0;aa<T.length;aa+=1){V=T[aa];ad=i(V);if(ad){if(!W.x&&!W.y&&!W.width&&!W.height){W.width=V.width;W.height=V.height;W.x=W.width/2;W.y=W.height/2}if(!aa){g(ad,W,W.width,W.height)}U=ad.getImageData(W.x-W.width/2,W.y-W.height/2,W.width,W.height);Y=U.data;Z=Y.length;ac=[];if(W.each!==x){for(X=0;X<Z;X+=4){ac.index=X/4;ac.r=Y[X];ac.g=Y[X+1];ac.b=Y[X+2];ac.a=Y[X+3];W.each.call(V,ac);Y[X]=ac.r;Y[X+1]=ac.g;Y[X+2]=ac.b;Y[X+3]=ac.a}}ad.putImageData(U,W.x-W.width/2,W.y-W.height/2);ad.restore()}}return T};function f(U,V){var T;for(T=0;T<U.length;T+=1){V[U[T]]=V["_"+U[T]]}}function h(U,V){var T;for(T=0;T<U.length;T+=1){V["_"+U[T]]=V[U[T]]}}D=["width","height","opacity"];E=["backgroundColor","color","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","fillStyle","strokeStyle","shadowColor",];function j(U){var X,W,V=[],T=1;if(typeof U==="object"){V=U}else{if(U.match(/^[a-z]+$/gi)){if(U===J){U="rgba(255,255,255,0)"}W=c.documentElement;X=W.style.color;W.style.color=U;U=z.css(W,"color");W.style.color=X}if(U.match(/^\#/gi)){if(U.length===4){U=U.replace(/([0-9a-f])/gi,"$1$1")}V=U.match(/[0-9a-f]{2}/gi);V[0]=o(V[0],16);V[1]=o(V[1],16);V[2]=o(V[2],16)}else{if(U.match(/^rgb/gi)){V=U.match(/[0-9\.]+/gi);if(U.match(/\%/gi)){T=2.55}V[0]=V[0]*T;V[1]=V[1]*T;V[2]=V[2]*T}}if(U.match("rgba")){V[3]=t(V[3])}else{V[3]=1}}return V}function R(U,T){U.now[T]=U.start[T]+(U.end[T]-U.start[T])*U.pos;if(T<3){U.now[T]=O(U.now[T])}}function L(T){if(typeof T.start!=="object"){T.start=j(T.start);T.end=j(T.end)}T.now=[];R(T,0);R(T,1);R(T,2);R(T,3);T.now="rgba("+T.now.join(",")+")";if(T.elem.style){T.elem.style[T.prop]=T.now}else{T.elem[T.prop]=T.now}}function l(T){var U;for(U=0;U<T.length;U+=1){if(!z.fx.step[T[U]]){z.fx.step[T[U]]=L}}}z.fn.getLayers=function(){var T=this[0],U;if(!T||!T.getContext){U=x}else{U=z.data(T,"jCanvas-layers");if(!U){U=[];z.data(T,"jCanvas-layers",U)}}return U};z.fn.getLayer=function(T){var W=this.getLayers(),V,U;if(!W){V=x}else{if(typeof T==="string"){for(U=0;U<W.length;U+=1){if(W[U].name===T){T=U;break}}}T=T||0;V=W[T]}return V};function a(U,T,V){if(V.visible){if(V.method==="draw"){V.call(U[0],T)}else{if(z.fn[V.method]){z.fn[V.method].call(U,V)}}}}z.fn.drawLayers=function(){var Z=this,U,T,Y,W,X,V;for(X=0;X<Z.length;X+=1){U=z(Z[X]);T=i(U[0]);if(T){Y=U.getLayers();T.clearRect(0,0,U[0].width,U[0].height);for(V=0;V<Y.length;V+=1){W=Y[V];a(U,T,W)}}}return Z};z.fn.addLayer=function(V){var aa=this,U,Y,T,Z=G(V,new F(),G({},V)),X,W;Z.layer=w;for(Y=0;Y<aa.length;Y+=1){U=z(aa[Y]);T=i(U[0]);if(T){X=U.getLayers();if(typeof Z==="function"){Z.method="draw"}else{if(Z.method!=="drawImage"){Z.width=Z.width||0;Z.height=Z.height||0}for(W in P.events){if(P.events.hasOwnProperty(W)&&Z[W]){if(!P.events[W].called){P.events[W].call(H,U)}Z.event=w}}}X.push(Z);a(U,T,Z)}}return aa};z.fn.removeLayers=function(){var V=this,U,T;for(T=0;T<V.length;T+=1){U=z(V[T]).getLayers()||[];U.length=0}return V};z.fn.removeLayer=function(T){var Y=this,X,V=typeof T,W,U;for(X=0;X<Y.length;X+=1){W=z(Y[X]).getLayers()||[];if(V==="string"){for(U=0;U<W.length;U+=1){if(W[U].name===T){W.splice(U,1);break}}}else{if(V==="number"){W.splice(T,1)}}}return Y};z.fn.animateLayer=function(){var Z=this,U,Y,V=([]).slice.call(arguments,0),W;if(typeof V[0]==="object"&&!V[0].layer){V.unshift(0)}if(V[2]===A){V.splice(2,0,x);V.splice(3,0,x);V.splice(4,0,x)}else{if(typeof V[2]==="function"){V.splice(2,0,x);V.splice(3,0,x)}}if(V[3]===A){V[3]=x;V.splice(4,0,x)}else{if(typeof V[3]==="function"){V.splice(3,0,x)}}if(V[4]===A){V[4]=x}function T(aa){return function(){f(D,aa);Z.drawLayers();if(V[4]){V[4].call(Z)}}}function X(aa){return function(){f(D,aa);Z.drawLayers()}}for(Y=0;Y<Z.length;Y+=1){U=z(Z[Y]);if(i(Z[Y])){if(V[0].layer){W=V[0]}else{W=U.getLayer(V[0])}if(W&&W.method!=="draw"){h(D,W);h(D,V[1]);z(W).animate(V[1],{duration:V[2],easing:(z.easing[V[3]]?V[3]:x),complete:T(W),step:X(W)})}}}return Z};z.event.fix=function(T){var U;T=k.call(z.event,T);if(T.pageX!==A&&T.offsetX===A){U=z(T.target).offset();if(U){T.offsetX=T.pageX-U.left;T.offsetY=T.pageY-U.top}}return T};l(E);z.support.canvas=(c.createElement("canvas").getContext!==A);P.defaults=B;P.prefs=S;P.extend=m;z.jCanvas=P}(jQuery,window,document,Math,Image,parseFloat,parseInt,true,false,null));